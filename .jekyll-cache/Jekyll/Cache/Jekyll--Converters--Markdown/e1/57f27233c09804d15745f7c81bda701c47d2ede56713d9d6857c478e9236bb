I"1t<h2 id="íšŒì›ê°€ì…-ê¸°ëŠ¥-êµ¬í˜„í•´ë³´ê¸°">íšŒì›ê°€ì… ê¸°ëŠ¥ êµ¬í˜„í•´ë³´ê¸°</h2>

<blockquote>
  <p>í•„ìëŠ” <a href="https://www.django-rest-framework.org/tutorial/quickstart/">drf ê³µì‹ë¬¸ì„œ tutorial</a> ì„ í†µí•´ì„œ ê¸°ë³¸ì ì¸ íšŒì›ê°€ì… ê¸°ëŠ¥ì„ êµ¬í˜„í•´ë†“ì€ ìƒíƒœì…ë‹ˆë‹¤.</p>
</blockquote>

<p><em>drfë¥¼ ì‚¬ìš©í•˜ì§€ ì•Šê³  êµ¬í˜„í–ˆë˜ íšŒì›ê°€ì… ê¸°ëŠ¥ì€ ì´ì œ ì¢€ í•´ë´¤ë‹¤ê³  ìµìˆ™í•´ì¡Œì§€ë§Œ drfë¥¼ ì ìš©í•˜ë‹ˆ ìµìˆ™í–ˆë˜ ê²Œ ì •ë§ ì–´ë ¤ì›Œì§„ë‹¤. ğŸ˜° í•˜ì§€ë§Œ drfì™€ ì¹œí•´ì§€ëŠ” ì‹œê°„ì„ ë§ì´ ê°€ì ¸ì•¼ í•  ê²ƒ ê°™ê¸° ë•Œë¬¸ì— drfë¥¼ ì‚¬ìš©í•´ì„œ ê¸°ëŠ¥ì„ êµ¬í˜„í•´ë³´ê¸°ë¡œ í–ˆë‹¤.</em></p>

<p><img width="1207" alt="á„‰á…³á„á…³á„…á…µá†«á„‰á…£á†º 2021-11-14 á„‹á…©á„’á…® 11 33 41" src="https://user-images.githubusercontent.com/73830753/141685621-d630b342-f218-468c-9400-3c1aa53a0ee3.png" /></p>

<p>ì¼ë‹¨ ìœ„ ê³µì‹ë¬¸ì„œ tutorialì„ ì˜ ë”°ë¼í•˜ë©´ <code class="language-plaintext highlighter-rouge">http://127.0.0.1:8000/users/</code>ì— ì ‘ì†í–ˆì„ ë•Œ user ì •ë³´ë¥¼ post í•  ìˆ˜ ìˆëŠ” í™”ë©´ì´ ì˜ ëœ¬ë‹¤.
<img width="1212" alt="á„‰á…³á„á…³á„…á…µá†«á„‰á…£á†º 2021-11-14 á„‹á…©á„’á…® 11 38 33" src="https://user-images.githubusercontent.com/73830753/141685831-3dfaf9fe-24e5-4e0c-b8e2-b80cb45540f7.png" />
í”„ë¡œì íŠ¸ì™€ ì—°ê²°ëœ dbì˜ <code class="language-plaintext highlighter-rouge">auth_user</code> í…Œì´ë¸”ì„ í™•ì¸í•˜ë©´ user ì •ë³´ê°€ ì˜ ë“¤ì–´ê°„ ê±¸ í™•ì¸ í•  ìˆ˜ ìˆë‹¤.</p>

<p>ê·¸ëŸ°ë° í•˜ë‚˜ì˜ userë¥¼ ë” ì¶”ê°€í•˜ë ¤ê³  í•˜ë‹ˆ <code class="language-plaintext highlighter-rouge">1062, "Duplicate entry "For key 'username'"</code> ì´ë¼ëŠ” ì—ëŸ¬ê°€ ë°œìƒí–ˆë‹¤. ì•„ë§ˆ usernameì´ uniqueí•œ í•„ë“œë¡œ ì„¤ì •ë˜ì–´ ìˆëŠ”ë° usernameì„ serializerì— ë„£ì§€ ì•Šìœ¼ë‹ˆ ë¹ˆ ë¬¸ìì—´ë¡œ ë“¤ì–´ê°€ì„œ usernameì´ ì¤‘ë³µë˜ì–´ ë°œìƒí•œ ë¬¸ì œê°™ì•˜ë‹¤.</p>

<p>ì´ ë¬¸ì œë¥¼ í•´ê²°í•˜ê¸° ìœ„í•´ì„œ usernameì˜ <code class="language-plaintext highlighter-rouge">unique=True</code> ì˜µì…˜ì„ ë³€ê²½í•´ì¤˜ì•¼ í•  ê²ƒ ê°™ë‹¤. ê·¸ë¦¬ê³  dbì— passwordê°€ ì…ë ¥í•œ ê·¸ëŒ€ë¡œ ë“¤ì–´ê°€ì„œ ë³´ì•ˆì„ ìœ„í•´ passwordë¥¼ ì•”í˜¸í™”í•˜ì—¬ dbì— ë„£ì–´ì£¼ì–´ì•¼ í•  ê²ƒ ê°™ë‹¤. ì´ ë¬¸ì œë“¤ì„ ì°¨ê·¼ì°¨ê·¼ í•´ê²°í•´ë³´ì! ì´ë²ˆ ê¸€ì—ì„œëŠ” django ìœ ì € ê¸°ë³¸ ëª¨ë¸ì„ ë³€ê²½í•´ì£¼ì–´ ì²«ë²ˆì§¸ ë¬¸ì œë¥¼ í•´ê²°í•´ë³´ê² ë‹¤.</p>

<h2 id="table-field-ì˜µì…˜-ë³€ê²½">table field ì˜µì…˜ ë³€ê²½</h2>

<p>ì°¾ì•„ë³´ë‹ˆ djangoì—ì„œ ê¸°ë³¸ì ìœ¼ë¡œ ì œê³µë˜ëŠ” ìœ ì € ëª¨ë¸ì€ ë¡œê·¸ì¸í•  ë•Œ usernameìœ¼ë¡œ ë¡œê·¸ì¸í•´ì•¼ëœë‹¤ê³  í•œë‹¤.(ê·¸ë˜ì„œ unique=True ì˜µì…˜ì„ ì¤¬ë‚˜ë³´ë‹¤.) ê·¸ë˜ì„œ ì»¤ìŠ¤í…€ ìœ ì € ëª¨ë¸ì„ ë§Œë“¤ê¸°ë¡œ í–ˆë‹¤!</p>

<h3 id="custom-user-model">Custom user model</h3>

<h4 id="model-ì‘ì„±í•˜ê¸°">model ì‘ì„±í•˜ê¸°</h4>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># accounts/models.py
</span><span class="kn">from</span> <span class="nn">django.db</span> <span class="kn">import</span> <span class="n">models</span>
<span class="kn">from</span> <span class="nn">django.contrib.auth.models</span> <span class="kn">import</span> <span class="n">BaseUserManager</span><span class="p">,</span> <span class="n">AbstractBaseUser</span>


<span class="k">class</span> <span class="nc">UserManager</span><span class="p">(</span><span class="n">BaseUserManager</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">create_user</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">email</span><span class="p">,</span> <span class="n">password</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">email</span><span class="p">:</span>
            <span class="k">raise</span> <span class="nb">ValueError</span><span class="p">(</span><span class="s">"Users must have an email address"</span><span class="p">)</span>

        <span class="n">user</span> <span class="o">=</span> <span class="bp">self</span><span class="p">.</span><span class="n">model</span><span class="p">(</span><span class="n">email</span><span class="o">=</span><span class="bp">self</span><span class="p">.</span><span class="n">normalize_email</span><span class="p">(</span><span class="n">email</span><span class="p">))</span>
        <span class="n">user</span><span class="p">.</span><span class="n">set_password</span><span class="p">(</span><span class="n">password</span><span class="p">)</span>
        <span class="n">user</span><span class="p">.</span><span class="n">save</span><span class="p">(</span><span class="n">using</span><span class="o">=</span><span class="bp">self</span><span class="p">.</span><span class="n">_db</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">user</span>

    <span class="k">def</span> <span class="nf">create_superuser</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">email</span><span class="p">,</span> <span class="n">password</span><span class="p">):</span>
        <span class="n">user</span> <span class="o">=</span> <span class="bp">self</span><span class="p">.</span><span class="n">create_user</span><span class="p">(</span><span class="n">email</span><span class="p">,</span> <span class="n">password</span><span class="o">=</span><span class="n">password</span><span class="p">)</span>
        <span class="n">user</span><span class="p">.</span><span class="n">is_admin</span> <span class="o">=</span> <span class="bp">True</span>
        <span class="n">user</span><span class="p">.</span><span class="n">save</span><span class="p">(</span><span class="n">using</span><span class="o">=</span><span class="bp">self</span><span class="p">.</span><span class="n">_db</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">user</span>


<span class="k">class</span> <span class="nc">User</span><span class="p">(</span><span class="n">AbstractBaseUser</span><span class="p">):</span>
    <span class="n">email</span> <span class="o">=</span> <span class="n">models</span><span class="p">.</span><span class="n">EmailField</span><span class="p">(</span>
        <span class="n">verbose_name</span><span class="o">=</span><span class="s">"email"</span><span class="p">,</span>
        <span class="n">max_length</span><span class="o">=</span><span class="mi">255</span><span class="p">,</span>
        <span class="n">unique</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">is_active</span> <span class="o">=</span> <span class="n">models</span><span class="p">.</span><span class="n">BooleanField</span><span class="p">(</span><span class="n">default</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
    <span class="n">is_admin</span> <span class="o">=</span> <span class="n">models</span><span class="p">.</span><span class="n">BooleanField</span><span class="p">(</span><span class="n">default</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span>

    <span class="n">objects</span> <span class="o">=</span> <span class="n">UserManager</span><span class="p">()</span>

    <span class="n">USERNAME_FIELD</span> <span class="o">=</span> <span class="s">"email"</span>

    <span class="k">def</span> <span class="nf">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="p">.</span><span class="n">email</span>

    <span class="k">def</span> <span class="nf">has_perm</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">perm</span><span class="p">,</span> <span class="n">obj</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">True</span>

    <span class="k">def</span> <span class="nf">has_module_perms</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">app_label</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">True</span>

    <span class="o">@</span><span class="nb">property</span>
    <span class="k">def</span> <span class="nf">is_staff</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="p">.</span><span class="n">is_admin</span>
</code></pre></div></div>

<p>accounts ì•±ì— ìˆëŠ” <code class="language-plaintext highlighter-rouge">models.py</code> íŒŒì¼ì— ìœ„ì™€ ê°™ì´ ì½”ë“œë¥¼ ì‘ì„±í•´ì¤€ë‹¤. ìì„¸íˆ ëœ¯ì–´ë³´ì!</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">from</span> <span class="nn">django.db</span> <span class="kn">import</span> <span class="n">models</span>
<span class="kn">from</span> <span class="nn">django.contrib.auth.models</span> <span class="kn">import</span> <span class="n">BaseUserManager</span><span class="p">,</span> <span class="n">AbstractBaseUser</span>
</code></pre></div></div>

<p>ì»¤ìŠ¤í…€ ìœ ì € ëª¨ë¸ì„ ë§Œë“¤ê¸° ìœ„í•´ì„œëŠ” <code class="language-plaintext highlighter-rouge">BaseUserManager</code>ì™€ <code class="language-plaintext highlighter-rouge">AbstractBaseUser</code>ë¼ëŠ” ë‘ ê°œì˜ í´ë˜ìŠ¤ê°€ í•„ìš”í•˜ë‹¤ê³  í•œë‹¤. <code class="language-plaintext highlighter-rouge">BaseUserManager</code> í´ë˜ìŠ¤ëŠ” ìœ ì €ë¥¼ ìƒì„±í•˜ëŠ” ê²ƒì„ ë•ëŠ” í´ë˜ìŠ¤ì´ë©°, ì‹¤ì œ ëª¨ë¸ì€ <code class="language-plaintext highlighter-rouge">AbstractBaseUser</code>ì„ ìƒì†ë°›ì•„ ìƒì„±ë˜ëŠ” í´ë˜ìŠ¤ì´ë‹¤.</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">class</span> <span class="nc">UserManager</span><span class="p">(</span><span class="n">BaseUserManager</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">create_user</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">email</span><span class="p">,</span> <span class="n">password</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">email</span><span class="p">:</span>
            <span class="k">raise</span> <span class="nb">ValueError</span><span class="p">(</span><span class="s">"Users must have an email address"</span><span class="p">)</span>

        <span class="n">user</span> <span class="o">=</span> <span class="bp">self</span><span class="p">.</span><span class="n">model</span><span class="p">(</span><span class="n">email</span><span class="o">=</span><span class="bp">self</span><span class="p">.</span><span class="n">normalize_email</span><span class="p">(</span><span class="n">email</span><span class="p">))</span>
        <span class="n">user</span><span class="p">.</span><span class="n">set_password</span><span class="p">(</span><span class="n">password</span><span class="p">)</span>
        <span class="n">user</span><span class="p">.</span><span class="n">save</span><span class="p">(</span><span class="n">using</span><span class="o">=</span><span class="bp">self</span><span class="p">.</span><span class="n">_db</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">user</span>

    <span class="k">def</span> <span class="nf">create_superuser</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">email</span><span class="p">,</span> <span class="n">password</span><span class="p">):</span>
        <span class="n">user</span> <span class="o">=</span> <span class="bp">self</span><span class="p">.</span><span class="n">create_user</span><span class="p">(</span><span class="n">email</span><span class="p">,</span> <span class="n">password</span><span class="o">=</span><span class="n">password</span><span class="p">)</span>
        <span class="n">user</span><span class="p">.</span><span class="n">is_admin</span> <span class="o">=</span> <span class="bp">True</span>
        <span class="n">user</span><span class="p">.</span><span class="n">save</span><span class="p">(</span><span class="n">using</span><span class="o">=</span><span class="bp">self</span><span class="p">.</span><span class="n">_db</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">user</span>
</code></pre></div></div>

<p><code class="language-plaintext highlighter-rouge">BaseUserManager</code>ë¥¼ ìƒì†ë°›ì€ <code class="language-plaintext highlighter-rouge">UserManager</code> í´ë˜ìŠ¤ëŠ” í—¬í¼ í´ë˜ìŠ¤ì´ë‹¤. ì´ í´ë˜ìŠ¤ëŠ” ë‘ ê°€ì§€ í•¨ìˆ˜ë¥¼ ê°€ì§€ê³  ìˆë‹¤. í•¨ìˆ˜ì˜ email parameterëŠ” ì›ë˜ usernameì´ ë“¤ì–´ê°€ëŠ”ë°, ìš°ë¦¬ëŠ” username ëŒ€ì‹  emailì„ ì‚¬ìš©í•  ê²ƒì´ë¯€ë¡œ emailì„ ì „ë‹¬í•œë‹¤.</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">class</span> <span class="nc">User</span><span class="p">(</span><span class="n">AbstractBaseUser</span><span class="p">):</span>
    <span class="n">email</span> <span class="o">=</span> <span class="n">models</span><span class="p">.</span><span class="n">EmailField</span><span class="p">(</span>
        <span class="n">verbose_name</span><span class="o">=</span><span class="s">"email"</span><span class="p">,</span>
        <span class="n">max_length</span><span class="o">=</span><span class="mi">255</span><span class="p">,</span>
        <span class="n">unique</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">is_active</span> <span class="o">=</span> <span class="n">models</span><span class="p">.</span><span class="n">BooleanField</span><span class="p">(</span><span class="n">default</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
    <span class="n">is_admin</span> <span class="o">=</span> <span class="n">models</span><span class="p">.</span><span class="n">BooleanField</span><span class="p">(</span><span class="n">default</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span>

    <span class="n">objects</span> <span class="o">=</span> <span class="n">UserManager</span><span class="p">()</span>

    <span class="n">USERNAME_FIELD</span> <span class="o">=</span> <span class="s">"email"</span>

    <span class="k">def</span> <span class="nf">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="p">.</span><span class="n">email</span>

    <span class="k">def</span> <span class="nf">has_perm</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">perm</span><span class="p">,</span> <span class="n">obj</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">True</span>

    <span class="k">def</span> <span class="nf">has_module_perms</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">app_label</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">True</span>

    <span class="o">@</span><span class="nb">property</span>
    <span class="k">def</span> <span class="nf">is_staff</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="p">.</span><span class="n">is_admin</span>
</code></pre></div></div>

<p>ìœ„ëŠ” Userì˜ ì‹¤ì œ ëª¨ë¸ì´ë‹¤. ì´ ëª¨ë¸ì€ email, is_active, is_admin í•„ë“œë¥¼ ê°€ì§€ê³  ìˆë‹¤. is_active, is_admin í•„ë“œëŠ” djangoì˜ ìœ ì € ëª¨ë¸ì˜ í•„ìˆ˜ í•„ë“œì´ë‹¤.</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>    objects = UserManager()

    USERNAME_FIELD = "email"
</code></pre></div></div>
<p>ìœ„ëŠ” User ëª¨ë¸ì„ ìƒì„±í•˜ê¸° ìœ„í•´ ê¼­ í•„ìš”í•œ ë¶€ë¶„ì´ë‹¤. ìš°ë¦¬ê°€ ë§Œë“  í—¬í¼ í´ë˜ìŠ¤ë¥¼ ì‚¬ìš©í•˜ë„ë¡ ì„¤ì •í•˜ì˜€ìœ¼ë©°, username í•„ë“œë¥¼ emailë¡œ ì‚¬ìš©í•˜ê²Œ í•˜ì˜€ë‹¤.</p>

<h4 id="ê´€ë¦¬ì-í˜ì´ì§€-ìˆ˜ì •">ê´€ë¦¬ì í˜ì´ì§€ ìˆ˜ì •</h4>

<p>djangoì˜ admin í˜ì´ì§€ë¥¼ í†µí•´ userë¥¼ ê´€ë¦¬í•˜ê¸° ìœ„í•´ ê¸°ì¡´ django admin formì„ ì»¤ìŠ¤í…€í•œ ìœ ì € ëª¨ë¸ì— ë§ê²Œ ë°”ê¿”ì¤˜ì•¼ í•œë‹¤.</p>

<p><code class="language-plaintext highlighter-rouge">forms.py</code> ë¼ëŠ” íŒŒì¼ì„ ì•±ì•ˆì—ë‹¤ ìƒì„±í•œë‹¤.</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># accounts/forms.py
</span><span class="kn">from</span> <span class="nn">django</span> <span class="kn">import</span> <span class="n">forms</span>
<span class="kn">from</span> <span class="nn">django.contrib.auth.forms</span> <span class="kn">import</span> <span class="n">ReadOnlyPasswordHashField</span>

<span class="kn">from</span> <span class="nn">.models</span> <span class="kn">import</span> <span class="n">User</span>


<span class="k">class</span> <span class="nc">UserCreationForm</span><span class="p">(</span><span class="n">forms</span><span class="p">.</span><span class="n">ModelForm</span><span class="p">):</span>
    <span class="n">password1</span> <span class="o">=</span> <span class="n">forms</span><span class="p">.</span><span class="n">CharField</span><span class="p">(</span><span class="n">label</span><span class="o">=</span><span class="s">'Password'</span><span class="p">,</span> <span class="n">widget</span><span class="o">=</span><span class="n">forms</span><span class="p">.</span><span class="n">PasswordInput</span><span class="p">)</span>
    <span class="n">password2</span> <span class="o">=</span> <span class="n">forms</span><span class="p">.</span><span class="n">CharField</span><span class="p">(</span>
        <span class="n">label</span><span class="o">=</span><span class="s">'Password confirmation'</span><span class="p">,</span> <span class="n">widget</span><span class="o">=</span><span class="n">forms</span><span class="p">.</span><span class="n">PasswordInput</span><span class="p">)</span>

    <span class="k">class</span> <span class="nc">Meta</span><span class="p">:</span>
        <span class="n">model</span> <span class="o">=</span> <span class="n">User</span>
        <span class="n">fields</span> <span class="o">=</span> <span class="p">(</span><span class="s">'email'</span><span class="p">,)</span>

    <span class="k">def</span> <span class="nf">clean_password2</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">password1</span> <span class="o">=</span> <span class="bp">self</span><span class="p">.</span><span class="n">cleaned_data</span><span class="p">.</span><span class="n">get</span><span class="p">(</span><span class="s">"password1"</span><span class="p">)</span>
        <span class="n">password2</span> <span class="o">=</span> <span class="bp">self</span><span class="p">.</span><span class="n">cleaned_data</span><span class="p">.</span><span class="n">get</span><span class="p">(</span><span class="s">"password2"</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">password1</span> <span class="ow">and</span> <span class="n">password2</span> <span class="ow">and</span> <span class="n">password1</span> <span class="o">!=</span> <span class="n">password2</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">forms</span><span class="p">.</span><span class="n">ValidationError</span><span class="p">(</span><span class="s">"Passwords don't match"</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">password2</span>

    <span class="k">def</span> <span class="nf">save</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">commit</span><span class="o">=</span><span class="bp">True</span><span class="p">):</span>
        <span class="n">user</span> <span class="o">=</span> <span class="nb">super</span><span class="p">().</span><span class="n">save</span><span class="p">(</span><span class="n">commit</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span>
        <span class="n">user</span><span class="p">.</span><span class="n">set_password</span><span class="p">(</span><span class="bp">self</span><span class="p">.</span><span class="n">cleaned_data</span><span class="p">[</span><span class="s">"password1"</span><span class="p">])</span>
        <span class="k">if</span> <span class="n">commit</span><span class="p">:</span>
            <span class="n">user</span><span class="p">.</span><span class="n">save</span><span class="p">()</span>
        <span class="k">return</span> <span class="n">user</span>


<span class="k">class</span> <span class="nc">UserChangeForm</span><span class="p">(</span><span class="n">forms</span><span class="p">.</span><span class="n">ModelForm</span><span class="p">):</span>
    <span class="n">password</span> <span class="o">=</span> <span class="n">ReadOnlyPasswordHashField</span><span class="p">()</span>

    <span class="k">class</span> <span class="nc">Meta</span><span class="p">:</span>
        <span class="n">model</span> <span class="o">=</span> <span class="n">User</span>
        <span class="n">fields</span> <span class="o">=</span> <span class="p">(</span><span class="s">'email'</span><span class="p">,</span> <span class="s">'password'</span><span class="p">,</span> <span class="s">'is_active'</span><span class="p">,</span> <span class="s">'is_admin'</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">clean_password</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="p">.</span><span class="n">initial</span><span class="p">[</span><span class="s">"password"</span><span class="p">]</span>
</code></pre></div></div>
<p>ìœ„ì™€ ê°™ì´ ì½”ë“œë¥¼ ì‘ì„±í•œë‹¤.</p>

<h4 id="admin-í˜ì´ì§€ì—-form-ì ìš©">admin í˜ì´ì§€ì— form ì ìš©</h4>

<p>ì‘ì„±í•œ formì„ admin í˜ì´ì§€ì— ì ìš©í•˜ê¸° ìœ„í•´ ì•±ì•ˆì˜ <code class="language-plaintext highlighter-rouge">admin.py</code> íŒŒì¼ì„ ìˆ˜ì •í•´ì¤€ë‹¤.</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># accounts/admin.py
</span><span class="kn">from</span> <span class="nn">django.contrib</span> <span class="kn">import</span> <span class="n">admin</span>
<span class="kn">from</span> <span class="nn">django.contrib.auth.models</span> <span class="kn">import</span> <span class="n">Group</span>
<span class="kn">from</span> <span class="nn">django.contrib.auth.admin</span> <span class="kn">import</span> <span class="n">UserAdmin</span> <span class="k">as</span> <span class="n">BaseUserAdmin</span>

<span class="kn">from</span> <span class="nn">.forms</span> <span class="kn">import</span> <span class="n">UserChangeForm</span><span class="p">,</span> <span class="n">UserCreationForm</span>
<span class="kn">from</span> <span class="nn">.models</span> <span class="kn">import</span> <span class="n">User</span>


<span class="k">class</span> <span class="nc">UserAdmin</span><span class="p">(</span><span class="n">BaseUserAdmin</span><span class="p">):</span>
    <span class="n">form</span> <span class="o">=</span> <span class="n">UserChangeForm</span>
    <span class="n">add_form</span> <span class="o">=</span> <span class="n">UserCreationForm</span>

    <span class="n">list_display</span> <span class="o">=</span> <span class="p">(</span><span class="s">'email'</span><span class="p">,</span> <span class="s">'is_admin'</span><span class="p">)</span>
    <span class="n">list_filter</span> <span class="o">=</span> <span class="p">(</span><span class="s">'is_admin'</span><span class="p">,)</span>
    <span class="n">fieldsets</span> <span class="o">=</span> <span class="p">(</span>
        <span class="p">(</span><span class="bp">None</span><span class="p">,</span> <span class="p">{</span><span class="s">'fields'</span><span class="p">:</span> <span class="p">(</span><span class="s">'email'</span><span class="p">,</span> <span class="s">'password'</span><span class="p">)}),</span>
        <span class="p">(</span><span class="s">'Permissions'</span><span class="p">,</span> <span class="p">{</span><span class="s">'fields'</span><span class="p">:</span> <span class="p">(</span><span class="s">'is_admin'</span><span class="p">,)}),</span>
    <span class="p">)</span>

    <span class="n">add_fieldsets</span> <span class="o">=</span> <span class="p">(</span>
        <span class="p">(</span><span class="bp">None</span><span class="p">,</span> <span class="p">{</span>
            <span class="s">'classes'</span><span class="p">:</span> <span class="p">(</span><span class="s">'wide'</span><span class="p">,),</span>
            <span class="s">'fields'</span><span class="p">:</span> <span class="p">(</span><span class="s">'email'</span><span class="p">,</span> <span class="s">'password1'</span><span class="p">,</span> <span class="s">'password2'</span><span class="p">)}</span>
         <span class="p">),</span>
    <span class="p">)</span>
    <span class="n">search_fields</span> <span class="o">=</span> <span class="p">(</span><span class="s">'email'</span><span class="p">,)</span>
    <span class="n">ordering</span> <span class="o">=</span> <span class="p">(</span><span class="s">'email'</span><span class="p">,)</span>
    <span class="n">filter_horizontal</span> <span class="o">=</span> <span class="p">()</span>


<span class="n">admin</span><span class="p">.</span><span class="n">site</span><span class="p">.</span><span class="n">register</span><span class="p">(</span><span class="n">User</span><span class="p">,</span> <span class="n">UserAdmin</span><span class="p">)</span>
<span class="n">admin</span><span class="p">.</span><span class="n">site</span><span class="p">.</span><span class="n">unregister</span><span class="p">(</span><span class="n">Group</span><span class="p">)</span>
</code></pre></div></div>
<p>ìœ„ì™€ ê°™ì´ ì½”ë“œë¥¼ ì‘ì„±í•œë‹¤.</p>

<h4 id="ì»¤ìŠ¤í…€-ìœ ì €-ëª¨ë¸-ë“±ë¡">ì»¤ìŠ¤í…€ ìœ ì € ëª¨ë¸ ë“±ë¡</h4>
<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># í”„ë¡œì íŠ¸í´ë”/settings.py
</span><span class="n">AUTH_USER_MODEL</span> <span class="o">=</span> <span class="s">"accounts.User"</span>
</code></pre></div></div>

<p>ìì‹ ì˜ í”„ë¡œì íŠ¸ í´ë”ì•ˆì— ìˆëŠ” <code class="language-plaintext highlighter-rouge">settings.py</code> íŒŒì¼ì— ìœ„ì™€ ê°™ì€ ì½”ë“œë¥¼ ì¶”ê°€í•œë‹¤. <code class="language-plaintext highlighter-rouge">"ì•±ì´ë¦„.User"</code>ë¡œ ì‘ì„±í•œë‹¤.</p>

<h4 id="í…Œì´ë¸”-ìƒì„±">í…Œì´ë¸” ìƒì„±</h4>

<p>ìœ„ ì½”ë“œë“¤ì„ ë‹¤ ì‘ì„±í•˜ë©´ makemigrationsê³¼ migrateë¥¼ í†µí•´ db í…Œì´ë¸”ì„ ìƒì„±í•œë‹¤.</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>+------------------------+
| Tables_in_django       |
+------------------------+
| accounts_user          |
| auth_group             |
| auth_group_permissions |
| auth_permission        |
| django_admin_log       |
| django_content_type    |
| django_migrations      |
| django_session         |
+------------------------+
</code></pre></div></div>
<p>í…Œì´ë¸”ì„ í™•ì¸í•˜ë©´ ìœ„ì™€ ê°™ì´ accounts_user í…Œì´ë¸”ì´ ìƒì„±ëœ ê²ƒì„ í™•ì¸í•  ìˆ˜ ìˆë‹¤.</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>+------------+--------------+------+-----+---------+----------------+
| Field      | Type         | Null | Key | Default | Extra          |
+------------+--------------+------+-----+---------+----------------+
| id         | int(11)      | NO   | PRI | NULL    | auto_increment |
| password   | varchar(128) | NO   |     | NULL    |                |
| last_login | datetime(6)  | YES  |     | NULL    |                |
| email      | varchar(255) | NO   | UNI | NULL    |                |
| is_active  | tinyint(1)   | NO   |     | NULL    |                |
| is_admin   | tinyint(1)   | NO   |     | NULL    |                |
+------------+--------------+------+-----+---------+----------------+
</code></pre></div></div>
<p>ìœ„ì™€ ê°™ì€ í…Œì´ë¸” ìŠ¤í‚¤ë§ˆê°€ ë§Œë“¤ì–´ì¡ŒëŠ”ë°, emailì´ unique í•„ë“œë¡œ ë“¤ì–´ê°„ ê²ƒì„ í™•ì¸í•  ìˆ˜ ìˆë‹¤.</p>

<p>ìƒì„±ëœ í…Œì´ë¸”ì„ í™•ì¸í•˜ê³  ë‹¤ì‹œ userë¥¼ ìƒì„±í•´ë³´ë©´</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>+----+-----------+------------+-----------------+-----------+----------+
| id | password  | last_login | email           | is_active | is_admin |
+----+-----------+------------+-----------------+-----------+----------+
|  1 | abcd1234! | NULL       | user1@gmail.com |         1 |        0 |
|  2 | abcd1234! | NULL       | user2@gmail.com |         1 |        0 |
+----+-----------+------------+-----------------+-----------+----------+
</code></pre></div></div>

<p>ë‹¤ìˆ˜ì˜ userê°€ ì˜ ë“¤ì–´ê°€ëŠ” ê²ƒì„ í™•ì¸í•  ìˆ˜ ìˆë‹¤.</p>

<h3><ì°¸ê³ ></ì°¸ê³ ></h3>

<ul>
  <li>https://dev-yakuza.posstree.com/ko/django/custom-user-model/</li>
</ul>
:ET