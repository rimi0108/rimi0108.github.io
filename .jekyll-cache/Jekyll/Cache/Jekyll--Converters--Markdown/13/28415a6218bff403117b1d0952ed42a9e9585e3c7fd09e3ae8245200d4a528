I"±ó<h2 id="ormì€-ê²Œìœ¼ë¥´ë‹¤-lazy-loading">ğŸ’¤Â ORMì€ ê²Œìœ¼ë¥´ë‹¤ (Lazy Loading)</h2>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># models.py
</span>
<span class="kn">from</span> <span class="nn">django.db</span> <span class="kn">import</span> <span class="n">models</span>

<span class="k">class</span> <span class="nc">Blog</span><span class="p">(</span><span class="n">models</span><span class="p">.</span><span class="n">Model</span><span class="p">):</span>
    <span class="n">name</span> <span class="o">=</span> <span class="n">models</span><span class="p">.</span><span class="n">CharField</span><span class="p">(</span><span class="n">max_length</span><span class="o">=</span><span class="mi">100</span><span class="p">)</span>
    <span class="n">tagline</span> <span class="o">=</span> <span class="n">models</span><span class="p">.</span><span class="n">TextField</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="p">.</span><span class="n">name</span>

<span class="k">class</span> <span class="nc">Author</span><span class="p">(</span><span class="n">models</span><span class="p">.</span><span class="n">Model</span><span class="p">):</span>
    <span class="n">name</span> <span class="o">=</span> <span class="n">models</span><span class="p">.</span><span class="n">CharField</span><span class="p">(</span><span class="n">max_length</span><span class="o">=</span><span class="mi">200</span><span class="p">)</span>
    <span class="n">email</span> <span class="o">=</span> <span class="n">models</span><span class="p">.</span><span class="n">EmailField</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="p">.</span><span class="n">name</span>

<span class="k">class</span> <span class="nc">Entry</span><span class="p">(</span><span class="n">models</span><span class="p">.</span><span class="n">Model</span><span class="p">):</span>
    <span class="n">blog</span> <span class="o">=</span> <span class="n">models</span><span class="p">.</span><span class="n">ForeignKey</span><span class="p">(</span><span class="n">Blog</span><span class="p">,</span> <span class="n">on_delete</span><span class="o">=</span><span class="n">models</span><span class="p">.</span><span class="n">CASCADE</span><span class="p">)</span>
    <span class="n">headline</span> <span class="o">=</span> <span class="n">models</span><span class="p">.</span><span class="n">CharField</span><span class="p">(</span><span class="n">max_length</span><span class="o">=</span><span class="mi">255</span><span class="p">)</span>
    <span class="n">body_text</span> <span class="o">=</span> <span class="n">models</span><span class="p">.</span><span class="n">TextField</span><span class="p">()</span>
    <span class="n">pub_date</span> <span class="o">=</span> <span class="n">models</span><span class="p">.</span><span class="n">DateField</span><span class="p">()</span>
    <span class="n">mod_date</span> <span class="o">=</span> <span class="n">models</span><span class="p">.</span><span class="n">DateField</span><span class="p">(</span><span class="n">default</span><span class="o">=</span><span class="n">date</span><span class="p">.</span><span class="n">today</span><span class="p">)</span>
    <span class="n">authors</span> <span class="o">=</span> <span class="n">models</span><span class="p">.</span><span class="n">ManyToManyField</span><span class="p">(</span><span class="n">Author</span><span class="p">)</span>
    <span class="n">number_of_comments</span> <span class="o">=</span> <span class="n">models</span><span class="p">.</span><span class="n">IntegerField</span><span class="p">(</span><span class="n">default</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
    <span class="n">number_of_pingbacks</span> <span class="o">=</span> <span class="n">models</span><span class="p">.</span><span class="n">IntegerField</span><span class="p">(</span><span class="n">default</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
    <span class="n">rating</span> <span class="o">=</span> <span class="n">models</span><span class="p">.</span><span class="n">IntegerField</span><span class="p">(</span><span class="n">default</span><span class="o">=</span><span class="mi">5</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="p">.</span><span class="n">headline</span>
</code></pre></div></div>

<p>ì´ëŸ° ëª¨ë¸ì„ ë§Œë“¤ì–´ ë°ì´í„°ë² ì´ìŠ¤ì— <code class="language-plaintext highlighter-rouge">migrate</code> í–ˆë‹¤ê³  ê°€ì •í•´ë³´ì.</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="o">&gt;&gt;&gt;</span> from blog.models import Blog
<span class="o">&gt;&gt;&gt;</span> blog <span class="o">=</span> Blog.objects.filter<span class="o">(</span><span class="nv">name</span><span class="o">=</span><span class="s2">"Beatles Blog"</span><span class="o">)</span>
<span class="o">&gt;&gt;&gt;</span> print<span class="o">(</span>blog<span class="o">)</span>
</code></pre></div></div>

<p>ìœ„ì™€ ê°™ì´ Blog ê°ì²´ë¥¼ filtering í•˜ëŠ” Queryë¬¸ì„ ë‚ ë¦°ë‹¤ë©´ database hitsëŠ” ëª‡ ë²ˆ ì¼ì–´ë‚ ê¹Œ? ì •ë‹µì€ <code class="language-plaintext highlighter-rouge">1ë²ˆ</code> ì´ë‹¤. ë§ˆì§€ë§‰ ì¤„ <code class="language-plaintext highlighter-rouge">print(blog)</code> ì—ì„œë§Œ db hitsê°€ ì¼ì–´ë‚˜ëŠ” ê²ƒì´ë‹¤. <em>Django ORM</em>ì€ QuerySetì´ í‰ê°€(evaluated)ë  ë•Œê¹Œì§€ ì‹¤ì œë¡œ ë°ì´í„°ë² ì´ìŠ¤ì— ì ‘ê·¼í•´ ì¿¼ë¦¬ë¥¼ ì‹¤í–‰í•˜ì§€ ì•ŠëŠ”ë‹¤.</p>

<h3 id="querysetì´-í‰ê°€evaluatedë˜ëŠ”-ì‹œì ">QuerySetì´ í‰ê°€(evaluated)ë˜ëŠ” ì‹œì </h3>

<p>ë‚´ë¶€ì ìœ¼ë¡œ, QuerySetì€ ë°ì´í„°ë² ì´ìŠ¤ì— hitting ë˜ì§€ ì•Šê³  í•„í„°ë§ë˜ê³ , ìŠ¬ë¼ì´ì‹± ë  ìˆ˜ ìˆë‹¤. querysetì„ í‰ê°€í•˜ê¸° ì „ê¹Œì§€ ë°ì´í„°ë² ì´ìŠ¤ í™œë™ì€ ì‹¤ì œë¡œ ìˆ˜í–‰ë˜ì§€ ì•ŠëŠ”ë‹¤.</p>

<h3 id="ì–´ë–¨-ë•Œ-querysetì„-í‰ê°€í•˜ëŠ”ê°€">ì–´ë–¨ ë•Œ querysetì„ í‰ê°€í•˜ëŠ”ê°€?</h3>

<ul>
  <li><strong>ë°˜ë³µ (Iteration)</strong></li>
</ul>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">for</span> <span class="n">b</span> <span class="ow">in</span> <span class="n">Blog</span><span class="p">.</span><span class="n">objects</span><span class="p">.</span><span class="nb">all</span><span class="p">():</span>
	<span class="k">print</span><span class="p">(</span><span class="n">b</span><span class="p">)</span>
</code></pre></div></div>

<ul>
  <li><strong>ìŠ¬ë¼ì´ì‹± (Slicing)</strong></li>
</ul>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">blogs</span> <span class="o">=</span> <span class="n">Blog</span><span class="p">.</span><span class="n">objects</span><span class="p">.</span><span class="nb">all</span><span class="p">()[::</span><span class="mi">2</span><span class="p">]</span>
</code></pre></div></div>

<p><em>step parameter</em>ë¥¼ ì“¸ ë•Œ í‰ê°€ë¨</p>

<ul>
  <li><strong>Picking / Caching</strong></li>
  <li><strong>repr()</strong></li>
</ul>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">blogs</span> <span class="o">=</span> <span class="nb">repr</span><span class="p">(</span><span class="n">Blog</span><span class="p">.</span><span class="n">objects</span><span class="p">.</span><span class="nb">all</span><span class="p">())</span>
</code></pre></div></div>

<ul>
  <li><strong>len()</strong></li>
</ul>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">blogs</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">Blog</span><span class="p">.</span><span class="n">objects</span><span class="p">.</span><span class="nb">all</span><span class="p">())</span>
</code></pre></div></div>

<ul>
  <li><strong>list()</strong></li>
</ul>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">blogs</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">Blog</span><span class="p">.</span><span class="n">objects</span><span class="p">.</span><span class="nb">all</span><span class="p">())</span>
</code></pre></div></div>

<ul>
  <li><strong>bool()</strong></li>
</ul>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">if</span> <span class="n">Blog</span><span class="p">.</span><span class="n">objects</span><span class="p">.</span><span class="nb">filter</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s">"Rim's Blog"</span><span class="p">):</span>
	<span class="k">print</span><span class="p">(</span><span class="s">"This is Rim's blog!"</span><span class="p">)</span>
</code></pre></div></div>

<h2 id="caching">ğŸ“¦Â Caching</h2>

<p>ê° QuerySetì—ëŠ” ë°ì´í„°ë² ì´ìŠ¤ ì ‘ê·¼ì„ ìµœì†Œí™”í•˜ê¸° ìœ„í•œ <strong>ìºì‹œ</strong>ê°€ í¬í•¨ë˜ì–´ ìˆë‹¤. ì´ ì‘ë™ ë°©ì‹ì„ ì´í•´í•˜ë©´ íš¨ìœ¨ì ì¸ ì½”ë“œë¥¼ ì‘ì„±í•  ìˆ˜ ìˆë‹¤.</p>

<p>QuerySetì´ ì²˜ìŒ í‰ê°€ë  ë•Œ, ë°ì´í„°ë² ì´ìŠ¤ ì¿¼ë¦¬ê°€ ë°œìƒí•œë‹¤. DjangoëŠ” ì¿¼ë¦¬ì˜ ê²°ê³¼ë¥¼ ìºì‹œì— ì €ì¥í•˜ê³  ìš”ì²­ëœ ê²°ê³¼ë¥¼ ë°˜í™˜í•œë‹¤. QuerySetì˜ ë‹¤ìŒ í‰ê°€ëŠ” ìºì‹œì— ì €ì¥ëœ ê²°ê³¼ë¥¼ <strong>ì¬ì‚¬ìš©</strong>í•œë‹¤.</p>

<p>ğŸ˜ˆÂ <strong>ìºì‹±ì„ ì ìš©í•˜ì§€ ì•Šì•˜ì„ ë•Œ</strong></p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">for</span> <span class="n">blog</span> <span class="ow">in</span> <span class="n">Blog</span><span class="p">.</span><span class="n">objects</span><span class="p">.</span><span class="nb">all</span><span class="p">():</span> <span class="c1"># ë°ì´í„°ë² ì´ìŠ¤ ì¿¼ë¦¬
</span>    <span class="k">print</span><span class="p">(</span><span class="n">blog</span><span class="p">.</span><span class="n">name</span><span class="p">)</span>

<span class="k">for</span> <span class="n">blog</span> <span class="ow">in</span> <span class="n">Blog</span><span class="p">.</span><span class="n">objects</span><span class="p">.</span><span class="nb">all</span><span class="p">():</span> <span class="c1"># ë°ì´í„°ë² ì´ìŠ¤ ë‹¤ì‹œ ì¿¼ë¦¬
</span>    <span class="k">print</span><span class="p">(</span><span class="n">blog</span><span class="p">.</span><span class="n">tagline</span><span class="p">)</span>
</code></pre></div></div>

<p>ìœ„ ì½”ë“œëŠ” ë‘ ê°œì˜ QuerySetì´ í‰ê°€ëœë‹¤.</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">(</span><span class="mf">0.000</span><span class="p">)</span> <span class="n">SELECT</span> <span class="s">"blog_blog"</span><span class="p">.</span><span class="s">"id"</span><span class="p">,</span> <span class="s">"blog_blog"</span><span class="p">.</span><span class="s">"name"</span><span class="p">,</span> <span class="s">"blog_blog"</span><span class="p">.</span><span class="s">"tagline"</span> <span class="n">FROM</span> <span class="s">"blog_blog"</span><span class="p">;</span> <span class="n">args</span><span class="o">=</span><span class="p">();</span> <span class="n">alias</span><span class="o">=</span><span class="n">default</span>
<span class="n">Beatles</span> <span class="n">Blog</span>
<span class="n">Rim</span><span class="s">'s Blog
(0.000) SELECT "blog_blog"."id", "blog_blog"."name", "blog_blog"."tagline" FROM "blog_blog"; args=(); alias=default
All the latest Beatles news.
This is the Rim'</span><span class="n">s</span> <span class="n">blog</span><span class="p">.</span>
</code></pre></div></div>

<p>ì´ ë•Œ ìºì‹±ì„ ì´ìš©í•˜ë©´ ë°ì´í„°ë² ì´ìŠ¤ ì¿¼ë¦¬ë¬¸ì„ ì¤„ì¼ ìˆ˜ ìˆë‹¤.</p>

<p>ğŸ˜‡Â <strong>ìºì‹±ì„ ì ìš©í–ˆì„ ë•Œ</strong></p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">blogs</span> <span class="o">=</span> <span class="n">Blog</span><span class="p">.</span><span class="n">objects</span><span class="p">.</span><span class="nb">all</span><span class="p">()</span> <span class="c1"># ë°ì´í„°ë² ì´ìŠ¤ ì¿¼ë¦¬
</span>
<span class="k">for</span> <span class="n">blog</span> <span class="ow">in</span> <span class="n">blogs</span><span class="p">:</span> <span class="c1"># ìºì‹œ ì‚¬ìš©  
</span>	<span class="k">print</span><span class="p">(</span><span class="n">blog</span><span class="p">.</span><span class="n">name</span><span class="p">)</span>

<span class="k">for</span> <span class="n">blog</span> <span class="ow">in</span> <span class="n">blogs</span><span class="p">:</span> <span class="c1"># ìºì‹œ ì‚¬ìš©
</span>	<span class="k">print</span><span class="p">(</span><span class="n">blog</span><span class="p">.</span><span class="n">tagline</span><span class="p">)</span>
</code></pre></div></div>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">(</span><span class="mf">0.000</span><span class="p">)</span> <span class="n">SELECT</span> <span class="s">"blog_blog"</span><span class="p">.</span><span class="s">"id"</span><span class="p">,</span> <span class="s">"blog_blog"</span><span class="p">.</span><span class="s">"name"</span><span class="p">,</span> <span class="s">"blog_blog"</span><span class="p">.</span><span class="s">"tagline"</span> <span class="n">FROM</span> <span class="s">"blog_blog"</span><span class="p">;</span> <span class="n">args</span><span class="o">=</span><span class="p">();</span> <span class="n">alias</span><span class="o">=</span><span class="n">default</span>
<span class="n">Beatles</span> <span class="n">Blog</span>
<span class="n">Rim</span><span class="s">'s Blog
All the latest Beatles news.
This is the Rim'</span><span class="n">s</span> <span class="n">blog</span><span class="p">.</span>
</code></pre></div></div>

<p>ìœ„ ì²˜ëŸ¼ querysetì´ í‰ê°€ë  ë•Œ ìºì‹œì— queryì˜ ê²°ê³¼ë¥¼ ì €ì¥í•˜ê¸° ë•Œë¬¸ì— ì¿¼ë¦¬ë¬¸ì´ í•œ ë²ˆë§Œ ë‚ ì•„ê°€ëŠ” ê²ƒì„ í™•ì¸í•  ìˆ˜ ìˆë‹¤.</p>

<h3 id="querysetì´-ìºì‹œë˜ì§€-ì•Šì„-ë•Œ">QuerySetì´ ìºì‹œë˜ì§€ ì•Šì„ ë•Œ</h3>

<p>QuerySetì´ í•­ìƒ ê²°ê³¼ë¥¼ ìºì‹œí•˜ëŠ” ê²ƒì€ ì•„ë‹ˆë‹¤. sliceë‚˜ indexë¡œ querysetì„ ì œí•œí•˜ë©´ ìºì‹œê°€ ë˜ì§€ ì•ŠëŠ”ë‹¤.</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">blogs</span> <span class="o">=</span> <span class="n">Blog</span><span class="p">.</span><span class="n">objects</span><span class="p">.</span><span class="nb">all</span><span class="p">()</span>

<span class="k">print</span><span class="p">(</span><span class="n">blogs</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="c1"># ë°ì´í„°ë² ì´ìŠ¤ ì¿¼ë¦¬
</span><span class="k">print</span><span class="p">(</span><span class="n">blogs</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="c1"># ë°ì´í„°ë² ì´ìŠ¤ ë‹¤ì‹œ ì¿¼ë¦¬
</span></code></pre></div></div>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">(</span><span class="mf">0.000</span><span class="p">)</span> <span class="n">SELECT</span> <span class="s">"blog_blog"</span><span class="p">.</span><span class="s">"id"</span><span class="p">,</span> <span class="s">"blog_blog"</span><span class="p">.</span><span class="s">"name"</span><span class="p">,</span> <span class="s">"blog_blog"</span><span class="p">.</span><span class="s">"tagline"</span> <span class="n">FROM</span> <span class="s">"blog_blog"</span> <span class="n">LIMIT</span> <span class="mi">1</span><span class="p">;</span> <span class="n">args</span><span class="o">=</span><span class="p">();</span> <span class="n">alias</span><span class="o">=</span><span class="n">default</span>
<span class="n">Beatles</span> <span class="n">Blog</span>
<span class="p">(</span><span class="mf">0.000</span><span class="p">)</span> <span class="n">SELECT</span> <span class="s">"blog_blog"</span><span class="p">.</span><span class="s">"id"</span><span class="p">,</span> <span class="s">"blog_blog"</span><span class="p">.</span><span class="s">"name"</span><span class="p">,</span> <span class="s">"blog_blog"</span><span class="p">.</span><span class="s">"tagline"</span> <span class="n">FROM</span> <span class="s">"blog_blog"</span> <span class="n">LIMIT</span> <span class="mi">1</span><span class="p">;</span> <span class="n">args</span><span class="o">=</span><span class="p">();</span> <span class="n">alias</span><span class="o">=</span><span class="n">default</span>
<span class="n">Beatles</span> <span class="n">Blog</span>
</code></pre></div></div>

<p>ìœ„ì²˜ëŸ¼ queyset objectì—ì„œ íŠ¹ì • ì¸ë±ìŠ¤ë¥¼ ë°˜ë³µì ìœ¼ë¡œ ê°€ì ¸ì˜¤ë©´ ë§¤ë²ˆ ë°ì´í„°ë² ì´ìŠ¤ë¥¼ ì¿¼ë¦¬í•œë‹¤.</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">blogs</span> <span class="o">=</span> <span class="n">Blog</span><span class="p">.</span><span class="n">objects</span><span class="p">.</span><span class="nb">all</span><span class="p">()</span>

<span class="k">for</span> <span class="n">blog</span> <span class="ow">in</span> <span class="n">blogs</span><span class="p">:</span> <span class="c1"># ë°ì´í„°ë² ì´ìŠ¤ ì¿¼ë¦¬
</span>	<span class="k">print</span><span class="p">(</span><span class="n">blog</span><span class="p">)</span>

<span class="k">print</span><span class="p">(</span><span class="n">blogs</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="c1"># ìºì‹œ ì‚¬ìš©
</span><span class="k">print</span><span class="p">(</span><span class="n">blogs</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="c1"># ìºì‹œ ì‚¬ìš©
</span></code></pre></div></div>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">(</span><span class="mf">0.000</span><span class="p">)</span> <span class="n">SELECT</span> <span class="s">"blog_blog"</span><span class="p">.</span><span class="s">"id"</span><span class="p">,</span> <span class="s">"blog_blog"</span><span class="p">.</span><span class="s">"name"</span><span class="p">,</span> <span class="s">"blog_blog"</span><span class="p">.</span><span class="s">"tagline"</span> <span class="n">FROM</span> <span class="s">"blog_blog"</span><span class="p">;</span> <span class="n">args</span><span class="o">=</span><span class="p">();</span> <span class="n">alias</span><span class="o">=</span><span class="n">default</span>
<span class="n">Beatles</span> <span class="n">Blog</span>
<span class="n">Rim</span><span class="s">'s Blog
Beatles Blog
Beatles Blog
</span></code></pre></div></div>

<p>ê·¸ëŸ¬ë‚˜ ìœ„ì²˜ëŸ¼ querysetì´ ì´ë¯¸ í‰ê°€ëœ ê²½ìš°, ìºì‹œë¥¼ ì‚¬ìš©í•  ìˆ˜ ìˆë‹¤.</p>

<h2 id="eagerloading-reslove-n1-problem">ğŸš…Â EagerLoading (Reslove N+1 Problem)</h2>

<p>ORMì€ ê²Œìœ¼ë¥´ê¸° ë•Œë¬¸ì— ê¸°ë³¸ì ìœ¼ë¡œ Lazy Loading ì „ëµì„ íƒí•œë‹¤ ğŸ˜ª. í•˜ì§€ë§Œ <strong>Eager Loading</strong> ì„ ì´ìš©í•˜ë©´ ì¦‰ì‹œ ë°ì´í„°ë¥¼ ê°€ì ¸ì˜¬ ìˆ˜ ìˆë‹¤.</p>

<h3 id="n1-problem">N+1 Problem</h3>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">class</span> <span class="nc">ExampleView</span><span class="p">(</span><span class="n">View</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">get</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">request</span><span class="p">):</span>
        <span class="n">entrys</span> <span class="o">=</span> <span class="n">Entry</span><span class="p">.</span><span class="n">objects</span><span class="p">.</span><span class="nb">all</span><span class="p">()</span>

        <span class="n">blog_name_list</span> <span class="o">=</span> <span class="p">[</span><span class="n">entry</span><span class="p">.</span><span class="n">blog</span> <span class="k">for</span> <span class="n">entry</span> <span class="ow">in</span> <span class="n">entrys</span><span class="p">]</span>

        <span class="k">return</span> <span class="n">HttpResponse</span><span class="p">(</span><span class="n">blog_name_list</span><span class="p">)</span>
</code></pre></div></div>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">(</span><span class="mf">0.000</span><span class="p">)</span> <span class="n">SELECT</span> <span class="s">"blog_entry"</span><span class="p">.</span><span class="s">"id"</span><span class="p">,</span> <span class="s">"blog_entry"</span><span class="p">.</span><span class="s">"blog_id"</span><span class="p">,</span> <span class="s">"blog_entry"</span><span class="p">.</span><span class="s">"headline"</span><span class="p">,</span> <span class="s">"blog_entry"</span><span class="p">.</span><span class="s">"body_text"</span><span class="p">,</span> <span class="s">"blog_entry"</span><span class="p">.</span><span class="s">"pub_date"</span><span class="p">,</span> <span class="s">"blog_entry"</span><span class="p">.</span><span class="s">"mod_date"</span><span class="p">,</span> <span class="s">"blog_entry"</span><span class="p">.</span><span class="s">"number_of_comments"</span><span class="p">,</span> <span class="s">"blog_entry"</span><span class="p">.</span><span class="s">"number_of_pingbacks"</span><span class="p">,</span> <span class="s">"blog_entry"</span><span class="p">.</span><span class="s">"rating"</span> <span class="n">FROM</span> <span class="s">"blog_entry"</span><span class="p">;</span> <span class="n">args</span><span class="o">=</span><span class="p">();</span> <span class="n">alias</span><span class="o">=</span><span class="n">default</span>
<span class="p">(</span><span class="mf">0.000</span><span class="p">)</span> <span class="n">SELECT</span> <span class="s">"blog_blog"</span><span class="p">.</span><span class="s">"id"</span><span class="p">,</span> <span class="s">"blog_blog"</span><span class="p">.</span><span class="s">"name"</span><span class="p">,</span> <span class="s">"blog_blog"</span><span class="p">.</span><span class="s">"tagline"</span> <span class="n">FROM</span> <span class="s">"blog_blog"</span> <span class="n">WHERE</span> <span class="s">"blog_blog"</span><span class="p">.</span><span class="s">"id"</span> <span class="o">=</span> <span class="mi">2</span> <span class="n">LIMIT</span> <span class="mi">21</span><span class="p">;</span> <span class="n">args</span><span class="o">=</span><span class="p">(</span><span class="mi">2</span><span class="p">,);</span> <span class="n">alias</span><span class="o">=</span><span class="n">default</span>
<span class="p">(</span><span class="mf">0.000</span><span class="p">)</span> <span class="n">SELECT</span> <span class="s">"blog_blog"</span><span class="p">.</span><span class="s">"id"</span><span class="p">,</span> <span class="s">"blog_blog"</span><span class="p">.</span><span class="s">"name"</span><span class="p">,</span> <span class="s">"blog_blog"</span><span class="p">.</span><span class="s">"tagline"</span> <span class="n">FROM</span> <span class="s">"blog_blog"</span> <span class="n">WHERE</span> <span class="s">"blog_blog"</span><span class="p">.</span><span class="s">"id"</span> <span class="o">=</span> <span class="mi">2</span> <span class="n">LIMIT</span> <span class="mi">21</span><span class="p">;</span> <span class="n">args</span><span class="o">=</span><span class="p">(</span><span class="mi">2</span><span class="p">,);</span> <span class="n">alias</span><span class="o">=</span><span class="n">default</span>
</code></pre></div></div>

<p>ë§Œì•½ Entry ëª¨ë¸ì˜ ëª¨ë“  ê°ì²´ë¥¼ ë¶ˆëŸ¬ì˜¨ í›„ ê° ê°ì²´ì˜ ì†ì„± blogë¥¼ ê°€ì ¸ì˜¤ê²Œ ë˜ë©´ blogëŠ” Blog ëª¨ë¸ê³¼ Foreignkeyë¥¼ í†µí•´ì„œ ì—°ê²°ëœ ì†ì„±ì´ê¸° ë•Œë¬¸ì— Blog ê°ì²´ë¥¼ ê²€ì‚¬í•˜ëŠ” queryë¬¸ì´ <em>forë¬¸ì´ ëŒì•„ê°ˆ ë•Œë§ˆë‹¤ ë°ì´í„°ë² ì´ìŠ¤ì— ë‚ ì•„ê°€ê²Œ ëœë‹¤</em>.</p>

<p>ì´ë ‡ê²Œ ì¼ì¼ì´ queryë¬¸ì„ ë³´ë‚´ëŠ” ì´ìœ ëŠ” ORMì˜ íŠ¹ì§•ì¸ Lazy Loading ë•Œë¬¸ì´ë‹¤. ORMì€ Entryì˜ ëª¨ë“  ê°ì²´ë¥¼ ê²€ì‚¬í•˜ëŠ” queryë¬¸ì„ ë³´ë‚´ê³  for ë¬¸ ì•ˆì—ì„œ entryì˜ blog ì •ë³´ë¥¼ ì°¾ëŠ”ë‹¤. í•˜ì§€ë§Œ ì²«ë²ˆì§¸ queryë¬¸ì—ì„œ ì›í•˜ëŠ” ì •ë³´ë¥¼ ì°¾ì§€ ëª»í•˜ë©´ ë‹¤ì‹œ queryë¬¸ì„ ë³´ë‚´ì–´ ì›í•˜ëŠ” ì •ë³´ë¥¼ ì°¾ê²Œëœë‹¤. <strong>ORMì€ í•„ìš”í•  ë•Œë§ˆë‹¤ queryë¬¸ì„ ë³´ë‚´ê¸° ë•Œë¬¸ì´ë‹¤.</strong></p>

<p>ì´ ì¶”ê°€ queryë¬¸ì€ ê°ì²´ë¥¼ ê²€ì‚¬í•  ë•Œë§ˆë‹¤ ë‚ ì•„ê°€ê¸° ë•Œë¬¸ì— ê°ì²´ì˜ ìˆ˜ê°€ ëŠ˜ì–´ë‚˜ë©´ ë” ë§ì€ queryë¬¸ì´ ë‚ ì•„ê°€ê²Œ ëœë‹¤.</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">(</span><span class="mf">0.000</span><span class="p">)</span> <span class="n">SELECT</span> <span class="s">"blog_entry"</span><span class="p">.</span><span class="s">"id"</span><span class="p">,</span> <span class="s">"blog_entry"</span><span class="p">.</span><span class="s">"blog_id"</span><span class="p">,</span> <span class="s">"blog_entry"</span><span class="p">.</span><span class="s">"headline"</span><span class="p">,</span> <span class="s">"blog_entry"</span><span class="p">.</span><span class="s">"body_text"</span><span class="p">,</span> <span class="s">"blog_entry"</span><span class="p">.</span><span class="s">"pub_date"</span><span class="p">,</span> <span class="s">"blog_entry"</span><span class="p">.</span><span class="s">"mod_date"</span><span class="p">,</span> <span class="s">"blog_entry"</span><span class="p">.</span><span class="s">"number_of_comments"</span><span class="p">,</span> <span class="s">"blog_entry"</span><span class="p">.</span><span class="s">"number_of_pingbacks"</span><span class="p">,</span> <span class="s">"blog_entry"</span><span class="p">.</span><span class="s">"rating"</span> <span class="n">FROM</span> <span class="s">"blog_entry"</span><span class="p">;</span> <span class="n">args</span><span class="o">=</span><span class="p">();</span> <span class="n">alias</span><span class="o">=</span><span class="n">default</span>
<span class="p">(</span><span class="mf">0.000</span><span class="p">)</span> <span class="n">SELECT</span> <span class="s">"blog_blog"</span><span class="p">.</span><span class="s">"id"</span><span class="p">,</span> <span class="s">"blog_blog"</span><span class="p">.</span><span class="s">"name"</span><span class="p">,</span> <span class="s">"blog_blog"</span><span class="p">.</span><span class="s">"tagline"</span> <span class="n">FROM</span> <span class="s">"blog_blog"</span> <span class="n">WHERE</span> <span class="s">"blog_blog"</span><span class="p">.</span><span class="s">"id"</span> <span class="o">=</span> <span class="mi">2</span> <span class="n">LIMIT</span> <span class="mi">21</span><span class="p">;</span> <span class="n">args</span><span class="o">=</span><span class="p">(</span><span class="mi">2</span><span class="p">,);</span> <span class="n">alias</span><span class="o">=</span><span class="n">default</span>
<span class="p">(</span><span class="mf">0.000</span><span class="p">)</span> <span class="n">SELECT</span> <span class="s">"blog_blog"</span><span class="p">.</span><span class="s">"id"</span><span class="p">,</span> <span class="s">"blog_blog"</span><span class="p">.</span><span class="s">"name"</span><span class="p">,</span> <span class="s">"blog_blog"</span><span class="p">.</span><span class="s">"tagline"</span> <span class="n">FROM</span> <span class="s">"blog_blog"</span> <span class="n">WHERE</span> <span class="s">"blog_blog"</span><span class="p">.</span><span class="s">"id"</span> <span class="o">=</span> <span class="mi">2</span> <span class="n">LIMIT</span> <span class="mi">21</span><span class="p">;</span> <span class="n">args</span><span class="o">=</span><span class="p">(</span><span class="mi">2</span><span class="p">,);</span> <span class="n">alias</span><span class="o">=</span><span class="n">default</span>
<span class="p">(</span><span class="mf">0.000</span><span class="p">)</span> <span class="n">SELECT</span> <span class="s">"blog_blog"</span><span class="p">.</span><span class="s">"id"</span><span class="p">,</span> <span class="s">"blog_blog"</span><span class="p">.</span><span class="s">"name"</span><span class="p">,</span> <span class="s">"blog_blog"</span><span class="p">.</span><span class="s">"tagline"</span> <span class="n">FROM</span> <span class="s">"blog_blog"</span> <span class="n">WHERE</span> <span class="s">"blog_blog"</span><span class="p">.</span><span class="s">"id"</span> <span class="o">=</span> <span class="mi">1</span> <span class="n">LIMIT</span> <span class="mi">21</span><span class="p">;</span> <span class="n">args</span><span class="o">=</span><span class="p">(</span><span class="mi">1</span><span class="p">,);</span> <span class="n">alias</span><span class="o">=</span><span class="n">default</span>
<span class="p">(</span><span class="mf">0.000</span><span class="p">)</span> <span class="n">SELECT</span> <span class="s">"blog_blog"</span><span class="p">.</span><span class="s">"id"</span><span class="p">,</span> <span class="s">"blog_blog"</span><span class="p">.</span><span class="s">"name"</span><span class="p">,</span> <span class="s">"blog_blog"</span><span class="p">.</span><span class="s">"tagline"</span> <span class="n">FROM</span> <span class="s">"blog_blog"</span> <span class="n">WHERE</span> <span class="s">"blog_blog"</span><span class="p">.</span><span class="s">"id"</span> <span class="o">=</span> <span class="mi">2</span> <span class="n">LIMIT</span> <span class="mi">21</span><span class="p">;</span> <span class="n">args</span><span class="o">=</span><span class="p">(</span><span class="mi">2</span><span class="p">,);</span> <span class="n">alias</span><span class="o">=</span><span class="n">default</span>
</code></pre></div></div>

<p>ìœ„ì²˜ëŸ¼ 2ê°œì˜ Entry ê°ì²´ë¥¼ ì¶”ê°€í•˜ì—¬ ë„£ì—ˆë”ë‹ˆ ë‘ ê°œì˜ ì¶”ê°€ queryë¬¸ì´ ë” ìƒê²¨ë‚¬ë‹¤. ë§Œì•½ 100ê°œ, 1000ê°œì˜ ê°ì²´ê°€ ë°ì´í„°ë² ì´ìŠ¤ì— ì¡´ì¬í•œë‹¤ë©´, queryë¬¸ì˜ ê°¯ìˆ˜ë„ ë˜‘ê°™ì´ ëŠ˜ì–´ë‚˜ ì„œë²„ ì‹¤í–‰ ì†ë„ëŠ” ëŠë ¤ì§ˆ ê²ƒì´ë‹¤. ğŸ¤¢</p>

<h3 id="querysetì˜-êµ¬ì„±ìš”ì†Œ">QuerySetì˜ êµ¬ì„±ìš”ì†Œ</h3>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># ì‹¤ì œ django.db.models.query.pyì— ìˆëŠ” QuerySetì˜ êµ¬ì„±ìš”ì†Œ
</span>
<span class="kn">from</span> <span class="nn">django.db.model.sql</span> <span class="kn">import</span> <span class="n">Query</span> <span class="c1"># Query()ëŠ” ê°œë°œìê°€ ì •ì˜í•œ QuerySetì„ ì½ì–´ì„œ ì‹¤ì œ SQLì„ ìƒì„±í•´ì£¼ëŠ” êµ¬í˜„ì œì´ë‹¤. 
</span>
<span class="k">class</span> <span class="nc">QuerySet</span><span class="p">:</span>
	<span class="n">query</span><span class="p">:</span> <span class="n">Query</span> <span class="o">=</span> <span class="n">Query</span><span class="p">()</span> <span class="c1"># ë©”ì¸ ì¿¼ë¦¬
</span>	<span class="n">_result_cache</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">Dict</span><span class="p">[</span><span class="n">Any</span><span class="p">,</span> <span class="n">Any</span><span class="p">]]</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span> <span class="c1"># SQLì˜ ìˆ˜í–‰ê²°ê³¼ë¥¼ ì—¬ê¸° ì €ì¥í•´ë†“ê³  ì¬ì‚¬ìš©í•œë‹¤. (QuerySet Cache)
</span>																							 <span class="c1"># QuerySet í˜¸ì¶œ ì‹œ ì´ í”„ë¡œí¼í‹°ì— ì €ì¥ëœ ë°ì´í„°ê°€ ì—†ìœ¼ë©´ SQLì„ í˜¸ì¶œí•´ì„œ ë°ì´í„°ë¥¼ ê°€ì ¸ì˜¨ë‹¤.
</span>	<span class="n">_prefetch_related_lookups</span><span class="p">:</span> <span class="n">Tuple</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="p">()</span> <span class="c1"># prefetch_relatedì„ ì´ í”„ë¡œí¼í‹°ì— ì €ì¥í•œë‹¤.
</span>																						 <span class="c1"># ì¶”ê°€ ì¿¼ë¦¬ì…‹
</span></code></pre></div></div>

<p>ìœ„ì˜ N+1 Problemì—ì„œ í™•ì¸í–ˆë˜ ê²ƒì²˜ëŸ¼ QuerySetì€ 1ê°œì˜ ì¿¼ë¦¬ì™€ 0 ~ Nê°œì˜ ì¶”ê°€ì¿¼ë¦¬(ì…‹)ìœ¼ë¡œ êµ¬ì„±ë˜ì–´ ìˆë‹¤. ìœ„ëŠ” ì‹¤ì œ QuerySetì´ ì‘ë™í•˜ëŠ” ì½”ë“œì´ë‹¤. ë©”ì¸ì¿¼ë¦¬ì™€ ì¶”ê°€ ì¿¼ë¦¬ì…‹ìœ¼ë¡œ ì´ë£¨ì–´ì ¸ ìˆëŠ” ê²ƒì„ ë³¼ ìˆ˜ ìˆë‹¤.</p>

<h3 id="ï¸select_related--prefetch_related">âœ”ï¸Â select_related() &amp; prefetch_related()</h3>

<p>Eager Loadingì„ ìˆ˜í–‰í•˜ê¸° ìœ„í•œ ì˜µì…˜ì¸ seleted_relatedì™€ prefetch_relatedì— ëŒ€í•´ ì•Œì•„ë³´ì.</p>

<p><strong>1) select_related()</strong></p>

<p><code class="language-plaintext highlighter-rouge">select_related</code>ëŠ” joinë¬¸ì„ í†µí•´ì„œ ë°ì´í„°ë¥¼ ì¦‰ì‹œ ë¡œë”©í•œë‹¤. ìœ„ì—ì„œ ìˆ˜í–‰í•œ <code class="language-plaintext highlighter-rouge">N+1 Problem</code>ì´ ë°œìƒí•œ ì½”ë“œë¥¼ <code class="language-plaintext highlighter-rouge">select_related</code>ë¥¼ í†µí•´ì„œ ì¶”ê°€ ì¿¼ë¦¬ê°€ ë°œìƒí•˜ì§€ ì•Šë„ë¡ ìˆ˜ì •ì„ í•  ìˆ˜ ìˆë‹¤.</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">class</span> <span class="nc">BlogDetailView</span><span class="p">(</span><span class="n">View</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">get</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">request</span><span class="p">):</span>
        <span class="n">entrys</span> <span class="o">=</span> <span class="n">Entry</span><span class="p">.</span><span class="n">objects</span><span class="p">.</span><span class="nb">all</span><span class="p">().</span><span class="n">select_related</span><span class="p">(</span><span class="s">"blog"</span><span class="p">)</span>

        <span class="n">blog_name_list</span> <span class="o">=</span> <span class="p">[</span><span class="n">entry</span><span class="p">.</span><span class="n">blog</span> <span class="k">for</span> <span class="n">entry</span> <span class="ow">in</span> <span class="n">entrys</span><span class="p">]</span>

        <span class="k">return</span> <span class="n">HttpResponse</span><span class="p">(</span><span class="n">blog_name_list</span><span class="p">)</span>
</code></pre></div></div>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">(</span><span class="mf">0.000</span><span class="p">)</span> <span class="n">SELECT</span> <span class="s">"blog_entry"</span><span class="p">.</span><span class="s">"id"</span><span class="p">,</span> <span class="s">"blog_entry"</span><span class="p">.</span><span class="s">"blog_id"</span><span class="p">,</span> <span class="s">"blog_entry"</span><span class="p">.</span><span class="s">"headline"</span><span class="p">,</span> <span class="s">"blog_entry"</span><span class="p">.</span><span class="s">"body_text"</span><span class="p">,</span> <span class="s">"blog_entry"</span><span class="p">.</span><span class="s">"pub_date"</span><span class="p">,</span> <span class="s">"blog_entry"</span><span class="p">.</span><span class="s">"mod_date"</span><span class="p">,</span> <span class="s">"blog_entry"</span><span class="p">.</span><span class="s">"number_of_comments"</span><span class="p">,</span> <span class="s">"blog_entry"</span><span class="p">.</span><span class="s">"number_of_pingbacks"</span><span class="p">,</span> <span class="s">"blog_entry"</span><span class="p">.</span><span class="s">"rating"</span><span class="p">,</span> <span class="s">"blog_blog"</span><span class="p">.</span><span class="s">"id"</span><span class="p">,</span> <span class="s">"blog_blog"</span><span class="p">.</span><span class="s">"name"</span><span class="p">,</span> <span class="s">"blog_blog"</span><span class="p">.</span><span class="s">"tagline"</span> <span class="n">FROM</span> <span class="s">"blog_entry"</span> <span class="n">INNER</span> <span class="n">JOIN</span> <span class="s">"blog_blog"</span> <span class="n">ON</span> <span class="p">(</span><span class="s">"blog_entry"</span><span class="p">.</span><span class="s">"blog_id"</span> <span class="o">=</span> <span class="s">"blog_blog"</span><span class="p">.</span><span class="s">"id"</span><span class="p">);</span> <span class="n">args</span><span class="o">=</span><span class="p">();</span> <span class="n">alias</span><span class="o">=</span><span class="n">default</span>
</code></pre></div></div>

<p>ìœ„ì™€ ê°™ì´ ì¶”ê°€ ì¿¼ë¦¬ê°€ ë°œìƒí–ˆë˜ ì†ì„± blogë¥¼ <code class="language-plaintext highlighter-rouge">select_related</code>ë¥¼ í†µí•´ ê°€ì ¸ì˜¤ë©´ ì¶”ê°€ ì¿¼ë¦¬ê°€ ë°œìƒí•˜ì§€ ì•ŠëŠ” ê²ƒì„ ë³¼ ìˆ˜ ìˆë‹¤. <code class="language-plaintext highlighter-rouge">INNER JOIN</code>ì„ ì‚¬ìš©í•˜ì—¬ blog í…Œì´ë¸”ì„ entry í…Œì´ë¸”ê³¼ í•¨ê»˜ ë¶ˆëŸ¬ì™€ ì¶”ê°€ ì¿¼ë¦¬ê°€ ë°œìƒí•˜ì§€ ì•Šë„ë¡ í•´ì£¼ëŠ” ê²ƒì´ë‹¤.</p>

<p><strong>2) prefetch_related()</strong></p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">class</span> <span class="nc">BlogDetailView</span><span class="p">(</span><span class="n">View</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">get</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">request</span><span class="p">):</span>
        <span class="n">entrys</span> <span class="o">=</span> <span class="n">Entry</span><span class="p">.</span><span class="n">objects</span><span class="p">.</span><span class="n">prefetch_related</span><span class="p">(</span><span class="s">"blog"</span><span class="p">).</span><span class="nb">all</span><span class="p">()</span>

        <span class="n">blog_name_list</span> <span class="o">=</span> <span class="p">[</span><span class="n">entry</span><span class="p">.</span><span class="n">blog</span> <span class="k">for</span> <span class="n">entry</span> <span class="ow">in</span> <span class="n">entrys</span><span class="p">]</span>

        <span class="k">return</span> <span class="n">HttpResponse</span><span class="p">(</span><span class="n">blog_name_list</span><span class="p">)</span>
</code></pre></div></div>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">(</span><span class="mf">0.000</span><span class="p">)</span> <span class="n">SELECT</span> <span class="s">"blog_entry"</span><span class="p">.</span><span class="s">"id"</span><span class="p">,</span> <span class="s">"blog_entry"</span><span class="p">.</span><span class="s">"blog_id"</span><span class="p">,</span> <span class="s">"blog_entry"</span><span class="p">.</span><span class="s">"headline"</span><span class="p">,</span> <span class="s">"blog_entry"</span><span class="p">.</span><span class="s">"body_text"</span><span class="p">,</span> <span class="s">"blog_entry"</span><span class="p">.</span><span class="s">"pub_date"</span><span class="p">,</span> <span class="s">"blog_entry"</span><span class="p">.</span><span class="s">"mod_date"</span><span class="p">,</span> <span class="s">"blog_entry"</span><span class="p">.</span><span class="s">"number_of_comments"</span><span class="p">,</span> <span class="s">"blog_entry"</span><span class="p">.</span><span class="s">"number_of_pingbacks"</span><span class="p">,</span> <span class="s">"blog_entry"</span><span class="p">.</span><span class="s">"rating"</span> <span class="n">FROM</span> <span class="s">"blog_entry"</span><span class="p">;</span> <span class="n">args</span><span class="o">=</span><span class="p">();</span> <span class="n">alias</span><span class="o">=</span><span class="n">default</span>
<span class="p">(</span><span class="mf">0.000</span><span class="p">)</span> <span class="n">SELECT</span> <span class="s">"blog_blog"</span><span class="p">.</span><span class="s">"id"</span><span class="p">,</span> <span class="s">"blog_blog"</span><span class="p">.</span><span class="s">"name"</span><span class="p">,</span> <span class="s">"blog_blog"</span><span class="p">.</span><span class="s">"tagline"</span> <span class="n">FROM</span> <span class="s">"blog_blog"</span> <span class="n">WHERE</span> <span class="s">"blog_blog"</span><span class="p">.</span><span class="s">"id"</span> <span class="n">IN</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">);</span> <span class="n">args</span><span class="o">=</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">);</span> <span class="n">alias</span><span class="o">=</span><span class="n">default</span>
</code></pre></div></div>

<p><code class="language-plaintext highlighter-rouge">prefetch_related</code>ë¥¼ ì‚¬ìš©í•˜ë©´ í•˜ë‚˜ì˜ ì¶”ê°€ ì¿¼ë¦¬ë¬¸ì´ ë” ë‚ ì•„ê°€ê²Œëœë‹¤. ì´ë ‡ê²Œ <code class="language-plaintext highlighter-rouge">prefetch_related</code>ëŠ” ì¶”ê°€ ì¿¼ë¦¬ë¥¼ í†µí•´ì„œ ì°¸ì¡°í•˜ê³  ìˆëŠ” í…Œì´ë¸”ì˜ ì •ë³´ë¥¼ ì „ë¶€ ê°€ì ¸ì˜¤ê²Œ ëœë‹¤.</p>

<h3 id="ê·¸ëŸ¼-select_relatedì™€-prefetch_related-ì¤‘-ì–´ë–¤-ê²ƒì„-ì“°ë©´-ì¢‹ì„ê¹Œ">ğŸ¤”Â ê·¸ëŸ¼ select_related()ì™€ prefetch_related ì¤‘ ì–´ë–¤ ê²ƒì„ ì“°ë©´ ì¢‹ì„ê¹Œ?</h3>

<p><code class="language-plaintext highlighter-rouge">select_related</code>ëŠ” <code class="language-plaintext highlighter-rouge">foreignkey</code> ë° 1:1 ê´€ê³„ì—ì„œ ì‚¬ìš©ë˜ë„ë¡ ì œí•œëœë‹¤. ê·¸ì— ë°˜í•´ <code class="language-plaintext highlighter-rouge">prefetch_related</code>ëŠ” ë‹¤ëŒ€ë‹¤ ê´€ê³„ ê´€ê³„ì—ì„œ ì‚¬ìš©ë  ìˆ˜ ìˆë‹¤.</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">class</span> <span class="nc">BlogMainView</span><span class="p">(</span><span class="n">View</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">get</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">request</span><span class="p">,</span> <span class="n">blog_id</span><span class="p">):</span>
        <span class="n">blog</span> <span class="o">=</span> <span class="n">Blog</span><span class="p">.</span><span class="n">objects</span><span class="p">.</span><span class="n">get</span><span class="p">(</span><span class="nb">id</span><span class="o">=</span><span class="n">blog_id</span><span class="p">)</span>
        <span class="n">entrys</span> <span class="o">=</span> <span class="n">Entry</span><span class="p">.</span><span class="n">objects</span><span class="p">.</span><span class="nb">filter</span><span class="p">(</span><span class="n">blog_id</span><span class="o">=</span><span class="n">blog_id</span><span class="p">)</span>
        <span class="n">results</span> <span class="o">=</span> <span class="p">[</span>
            <span class="p">{</span>
                <span class="s">"blog_name"</span><span class="p">:</span> <span class="n">blog</span><span class="p">.</span><span class="n">name</span><span class="p">,</span>
                <span class="s">"blog_tagline"</span><span class="p">:</span> <span class="n">blog</span><span class="p">.</span><span class="n">tagline</span><span class="p">,</span>
                <span class="s">"entry"</span><span class="p">:</span> <span class="p">[</span>
                    <span class="p">{</span>
                        <span class="s">"headline"</span><span class="p">:</span> <span class="n">entry</span><span class="p">.</span><span class="n">headline</span><span class="p">,</span>
                        <span class="s">"body_text"</span><span class="p">:</span> <span class="n">entry</span><span class="p">.</span><span class="n">body_text</span><span class="p">,</span>
                        <span class="s">"authors"</span><span class="p">:</span> <span class="p">[</span>
                            <span class="p">{</span><span class="s">"author"</span><span class="p">:</span> <span class="n">entry_author</span><span class="p">.</span><span class="n">name</span><span class="p">}</span>
                            <span class="k">for</span> <span class="n">entry_author</span> <span class="ow">in</span> <span class="n">entry</span><span class="p">.</span><span class="n">authors</span><span class="p">.</span><span class="nb">all</span><span class="p">()</span>
                        <span class="p">],</span>
                    <span class="p">}</span>
                    <span class="k">for</span> <span class="n">entry</span> <span class="ow">in</span> <span class="n">entrys</span>
                <span class="p">],</span>
            <span class="p">}</span>
        <span class="p">]</span>

        <span class="k">return</span> <span class="n">JsonResponse</span><span class="p">({</span><span class="s">"result"</span><span class="p">:</span> <span class="n">results</span><span class="p">},</span> <span class="n">status</span><span class="o">=</span><span class="mi">200</span><span class="p">)</span>
</code></pre></div></div>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">(</span><span class="mf">0.000</span><span class="p">)</span> <span class="n">SELECT</span> <span class="s">"blog_blog"</span><span class="p">.</span><span class="s">"id"</span><span class="p">,</span> <span class="s">"blog_blog"</span><span class="p">.</span><span class="s">"name"</span><span class="p">,</span> <span class="s">"blog_blog"</span><span class="p">.</span><span class="s">"tagline"</span> <span class="n">FROM</span> <span class="s">"blog_blog"</span> <span class="n">WHERE</span> <span class="s">"blog_blog"</span><span class="p">.</span><span class="s">"id"</span> <span class="o">=</span> <span class="mi">1</span> <span class="n">LIMIT</span> <span class="mi">21</span><span class="p">;</span> <span class="n">args</span><span class="o">=</span><span class="p">(</span><span class="mi">1</span><span class="p">,);</span> <span class="n">alias</span><span class="o">=</span><span class="n">default</span>
<span class="p">(</span><span class="mf">0.000</span><span class="p">)</span> <span class="n">SELECT</span> <span class="s">"blog_entry"</span><span class="p">.</span><span class="s">"id"</span><span class="p">,</span> <span class="s">"blog_entry"</span><span class="p">.</span><span class="s">"blog_id"</span><span class="p">,</span> <span class="s">"blog_entry"</span><span class="p">.</span><span class="s">"headline"</span><span class="p">,</span> <span class="s">"blog_entry"</span><span class="p">.</span><span class="s">"body_text"</span><span class="p">,</span> <span class="s">"blog_entry"</span><span class="p">.</span><span class="s">"pub_date"</span><span class="p">,</span> <span class="s">"blog_entry"</span><span class="p">.</span><span class="s">"mod_date"</span><span class="p">,</span> <span class="s">"blog_entry"</span><span class="p">.</span><span class="s">"number_of_comments"</span><span class="p">,</span> <span class="s">"blog_entry"</span><span class="p">.</span><span class="s">"number_of_pingbacks"</span><span class="p">,</span> <span class="s">"blog_entry"</span><span class="p">.</span><span class="s">"rating"</span> <span class="n">FROM</span> <span class="s">"blog_entry"</span> <span class="n">WHERE</span> <span class="s">"blog_entry"</span><span class="p">.</span><span class="s">"blog_id"</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span> <span class="n">args</span><span class="o">=</span><span class="p">(</span><span class="mi">1</span><span class="p">,);</span> <span class="n">alias</span><span class="o">=</span><span class="n">default</span>
<span class="p">(</span><span class="mf">0.000</span><span class="p">)</span> <span class="n">SELECT</span> <span class="s">"blog_author"</span><span class="p">.</span><span class="s">"id"</span><span class="p">,</span> <span class="s">"blog_author"</span><span class="p">.</span><span class="s">"name"</span><span class="p">,</span> <span class="s">"blog_author"</span><span class="p">.</span><span class="s">"email"</span> <span class="n">FROM</span> <span class="s">"blog_author"</span> <span class="n">INNER</span> <span class="n">JOIN</span> <span class="s">"blog_entry_authors"</span> <span class="n">ON</span> <span class="p">(</span><span class="s">"blog_author"</span><span class="p">.</span><span class="s">"id"</span> <span class="o">=</span> <span class="s">"blog_entry_authors"</span><span class="p">.</span><span class="s">"author_id"</span><span class="p">)</span> <span class="n">WHERE</span> <span class="s">"blog_entry_authors"</span><span class="p">.</span><span class="s">"entry_id"</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span> <span class="n">args</span><span class="o">=</span><span class="p">(</span><span class="mi">1</span><span class="p">,);</span> <span class="n">alias</span><span class="o">=</span><span class="n">default</span>
<span class="p">(</span><span class="mf">0.000</span><span class="p">)</span> <span class="n">SELECT</span> <span class="s">"blog_author"</span><span class="p">.</span><span class="s">"id"</span><span class="p">,</span> <span class="s">"blog_author"</span><span class="p">.</span><span class="s">"name"</span><span class="p">,</span> <span class="s">"blog_author"</span><span class="p">.</span><span class="s">"email"</span> <span class="n">FROM</span> <span class="s">"blog_author"</span> <span class="n">INNER</span> <span class="n">JOIN</span> <span class="s">"blog_entry_authors"</span> <span class="n">ON</span> <span class="p">(</span><span class="s">"blog_author"</span><span class="p">.</span><span class="s">"id"</span> <span class="o">=</span> <span class="s">"blog_entry_authors"</span><span class="p">.</span><span class="s">"author_id"</span><span class="p">)</span> <span class="n">WHERE</span> <span class="s">"blog_entry_authors"</span><span class="p">.</span><span class="s">"entry_id"</span> <span class="o">=</span> <span class="mi">2</span><span class="p">;</span> <span class="n">args</span><span class="o">=</span><span class="p">(</span><span class="mi">2</span><span class="p">,);</span> <span class="n">alias</span><span class="o">=</span><span class="n">default</span>
<span class="p">(</span><span class="mf">0.000</span><span class="p">)</span> <span class="n">SELECT</span> <span class="s">"blog_author"</span><span class="p">.</span><span class="s">"id"</span><span class="p">,</span> <span class="s">"blog_author"</span><span class="p">.</span><span class="s">"name"</span><span class="p">,</span> <span class="s">"blog_author"</span><span class="p">.</span><span class="s">"email"</span> <span class="n">FROM</span> <span class="s">"blog_author"</span> <span class="n">INNER</span> <span class="n">JOIN</span> <span class="s">"blog_entry_authors"</span> <span class="n">ON</span> <span class="p">(</span><span class="s">"blog_author"</span><span class="p">.</span><span class="s">"id"</span> <span class="o">=</span> <span class="s">"blog_entry_authors"</span><span class="p">.</span><span class="s">"author_id"</span><span class="p">)</span> <span class="n">WHERE</span> <span class="s">"blog_entry_authors"</span><span class="p">.</span><span class="s">"entry_id"</span> <span class="o">=</span> <span class="mi">3</span><span class="p">;</span> <span class="n">args</span><span class="o">=</span><span class="p">(</span><span class="mi">3</span><span class="p">,);</span> <span class="n">alias</span><span class="o">=</span><span class="n">default</span>
</code></pre></div></div>

<p>ìœ„ ì½”ë“œë¥¼ ë³´ë©´ ì¶”ê°€ queryê°€ ë°œìƒí•´ <code class="language-plaintext highlighter-rouge">N+1 Problem</code> ì´ ë°œìƒí•˜ê³  ìˆë‹¤.</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">class</span> <span class="nc">BlogMainView</span><span class="p">(</span><span class="n">View</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">get</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">request</span><span class="p">,</span> <span class="n">blog_id</span><span class="p">):</span>
        <span class="n">blog</span> <span class="o">=</span> <span class="n">Blog</span><span class="p">.</span><span class="n">objects</span><span class="p">.</span><span class="n">get</span><span class="p">(</span><span class="nb">id</span><span class="o">=</span><span class="n">blog_id</span><span class="p">)</span>
        <span class="n">entrys</span> <span class="o">=</span> <span class="n">Entry</span><span class="p">.</span><span class="n">objects</span><span class="p">.</span><span class="n">prefetch_related</span><span class="p">(</span><span class="s">"authors"</span><span class="p">).</span><span class="nb">filter</span><span class="p">(</span><span class="n">blog_id</span><span class="o">=</span><span class="n">blog_id</span><span class="p">)</span>
        <span class="n">results</span> <span class="o">=</span> <span class="p">[</span>
            <span class="p">{</span>
                <span class="s">"blog_name"</span><span class="p">:</span> <span class="n">blog</span><span class="p">.</span><span class="n">name</span><span class="p">,</span>
                <span class="s">"blog_tagline"</span><span class="p">:</span> <span class="n">blog</span><span class="p">.</span><span class="n">tagline</span><span class="p">,</span>
                <span class="s">"entry"</span><span class="p">:</span> <span class="p">[</span>
                    <span class="p">{</span>
                        <span class="s">"headline"</span><span class="p">:</span> <span class="n">entry</span><span class="p">.</span><span class="n">headline</span><span class="p">,</span>
                        <span class="s">"body_text"</span><span class="p">:</span> <span class="n">entry</span><span class="p">.</span><span class="n">body_text</span><span class="p">,</span>
                        <span class="s">"authors"</span><span class="p">:</span> <span class="p">[</span>
                            <span class="p">{</span><span class="s">"author"</span><span class="p">:</span> <span class="n">entry_author</span><span class="p">.</span><span class="n">name</span><span class="p">}</span>
                            <span class="k">for</span> <span class="n">entry_author</span> <span class="ow">in</span> <span class="n">entry</span><span class="p">.</span><span class="n">authors</span><span class="p">.</span><span class="nb">all</span><span class="p">()</span>
                        <span class="p">],</span>
                    <span class="p">}</span>
                    <span class="k">for</span> <span class="n">entry</span> <span class="ow">in</span> <span class="n">entrys</span>
                <span class="p">],</span>
            <span class="p">}</span>
        <span class="p">]</span>

        <span class="k">return</span> <span class="n">JsonResponse</span><span class="p">({</span><span class="s">"result"</span><span class="p">:</span> <span class="n">results</span><span class="p">},</span> <span class="n">status</span><span class="o">=</span><span class="mi">200</span><span class="p">)</span>
</code></pre></div></div>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">(</span><span class="mf">0.000</span><span class="p">)</span> <span class="n">SELECT</span> <span class="s">"blog_blog"</span><span class="p">.</span><span class="s">"id"</span><span class="p">,</span> <span class="s">"blog_blog"</span><span class="p">.</span><span class="s">"name"</span><span class="p">,</span> <span class="s">"blog_blog"</span><span class="p">.</span><span class="s">"tagline"</span> <span class="n">FROM</span> <span class="s">"blog_blog"</span> <span class="n">WHERE</span> <span class="s">"blog_blog"</span><span class="p">.</span><span class="s">"id"</span> <span class="o">=</span> <span class="mi">1</span> <span class="n">LIMIT</span> <span class="mi">21</span><span class="p">;</span> <span class="n">args</span><span class="o">=</span><span class="p">(</span><span class="mi">1</span><span class="p">,);</span> <span class="n">alias</span><span class="o">=</span><span class="n">default</span>
<span class="p">(</span><span class="mf">0.000</span><span class="p">)</span> <span class="n">SELECT</span> <span class="s">"blog_entry"</span><span class="p">.</span><span class="s">"id"</span><span class="p">,</span> <span class="s">"blog_entry"</span><span class="p">.</span><span class="s">"blog_id"</span><span class="p">,</span> <span class="s">"blog_entry"</span><span class="p">.</span><span class="s">"headline"</span><span class="p">,</span> <span class="s">"blog_entry"</span><span class="p">.</span><span class="s">"body_text"</span><span class="p">,</span> <span class="s">"blog_entry"</span><span class="p">.</span><span class="s">"pub_date"</span><span class="p">,</span> <span class="s">"blog_entry"</span><span class="p">.</span><span class="s">"mod_date"</span><span class="p">,</span> <span class="s">"blog_entry"</span><span class="p">.</span><span class="s">"number_of_comments"</span><span class="p">,</span> <span class="s">"blog_entry"</span><span class="p">.</span><span class="s">"number_of_pingbacks"</span><span class="p">,</span> <span class="s">"blog_entry"</span><span class="p">.</span><span class="s">"rating"</span> <span class="n">FROM</span> <span class="s">"blog_entry"</span> <span class="n">WHERE</span> <span class="s">"blog_entry"</span><span class="p">.</span><span class="s">"blog_id"</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span> <span class="n">args</span><span class="o">=</span><span class="p">(</span><span class="mi">1</span><span class="p">,);</span> <span class="n">alias</span><span class="o">=</span><span class="n">default</span>
<span class="p">(</span><span class="mf">0.000</span><span class="p">)</span> <span class="n">SELECT</span> <span class="p">(</span><span class="s">"blog_entry_authors"</span><span class="p">.</span><span class="s">"entry_id"</span><span class="p">)</span> <span class="n">AS</span> <span class="s">"_prefetch_related_val_entry_id"</span><span class="p">,</span> <span class="s">"blog_author"</span><span class="p">.</span><span class="s">"id"</span><span class="p">,</span> <span class="s">"blog_author"</span><span class="p">.</span><span class="s">"name"</span><span class="p">,</span> <span class="s">"blog_author"</span><span class="p">.</span><span class="s">"email"</span> <span class="n">FROM</span> <span class="s">"blog_author"</span> <span class="n">INNER</span> <span class="n">JOIN</span> <span class="s">"blog_entry_authors"</span> <span class="n">ON</span> <span class="p">(</span><span class="s">"blog_author"</span><span class="p">.</span><span class="s">"id"</span> <span class="o">=</span> <span class="s">"blog_entry_authors"</span><span class="p">.</span><span class="s">"author_id"</span><span class="p">)</span> <span class="n">WHERE</span> <span class="s">"blog_entry_authors"</span><span class="p">.</span><span class="s">"entry_id"</span> <span class="n">IN</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">);</span> <span class="n">args</span><span class="o">=</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">);</span> <span class="n">alias</span><span class="o">=</span><span class="n">default</span>
</code></pre></div></div>

<p><code class="language-plaintext highlighter-rouge">prefetch_related</code> ë¥¼ ì‚¬ìš©í•˜ë©´ ì¿¼ë¦¬ì˜ ìˆ˜ë¥¼ ì¤„ì¼ ìˆ˜ ìˆë‹¤. í•˜ì§€ë§Œ ì—¬ê¸°ì„œ <code class="language-plaintext highlighter-rouge">select_related</code> ë¥¼ ì‚¬ìš©í•˜ë©´ ì—ëŸ¬ê°€ ë°œìƒí•œë‹¤. <code class="language-plaintext highlighter-rouge">select_related</code> ëŠ” ë‹¤ëŒ€ë‹¤ ê´€ê³„ì—ì„œ ì‚¬ìš©í•  ìˆ˜ ì—†ê¸° ë•Œë¬¸ì´ë‹¤.</p>

<p><em>ğŸ™‹ğŸ»â€â™€ï¸Â : ê·¸ë˜ì„œ ì–´ë–¤ê±¸ ì‚¬ìš©í•˜ë¼ê³ ìš”.</em></p>

<p>ğŸ˜…Â ê²°ë¡  : ì¼ëŒ€ì¼ê´€ê³„ë‚˜ ì •ì°¸ì¡° ê´€ê³„ì—ì„œëŠ” <code class="language-plaintext highlighter-rouge">select_related</code> ë¥¼ ì‚¬ìš©í•˜ê³ , ë‹¤ëŒ€ë‹¤ê´€ê³„ë‚˜ ì—­ì°¸ì¡° ê´€ê³„ì—ì„œëŠ” <code class="language-plaintext highlighter-rouge">prefetch_related</code> ë¥¼ ì‚¬ìš©í•˜ì. ë§Œì•½ <code class="language-plaintext highlighter-rouge">select_related</code> ë¥¼ ì‚¬ìš©í•  ìˆ˜ ìˆëŠ” ìƒí™©ì´ë¼ë©´, queryì˜ ìˆ˜ê°€ í•˜ë‚˜ ë” ì¤„ì–´ë“œë‹ˆ ì™ ë§Œí•˜ë©´ <code class="language-plaintext highlighter-rouge">select_related</code> ë¥¼ ì‚¬ìš©í•˜ëŠ” ê²ƒì´ ì¢‹ë‹¤!</p>

<hr />

<h3><ì°¸ê³ ></ì°¸ê³ ></h3>

<ul>
  <li><a href="https://docs.djangoproject.com/en/4.0/topics/db/queries/#querysets-are-lazy">https://docs.djangoproject.com/en/4.0/topics/db/queries/#querysets-are-lazy</a></li>
  <li><a href="https://docs.djangoproject.com/en/4.0/ref/models/querysets/#when-querysets-are-evaluated">https://docs.djangoproject.com/en/4.0/ref/models/querysets/#when-querysets-are-evaluated</a></li>
  <li><a href="https://docs.djangoproject.com/en/4.0/topics/db/queries/#caching-and-querysets">https://docs.djangoproject.com/en/4.0/topics/db/queries/#caching-and-querysets</a></li>
  <li><a href="https://www.youtube.com/watch?v=EZgLfDrUlrk&amp;t=113s">https://www.youtube.com/watch?v=EZgLfDrUlrk&amp;t=113s</a></li>
</ul>
:ET