I"„%<p><a href="https://rimi0108.github.io/django/drf1/">[Django] DRFë¡œ íšŒì›ê°€ì… ê¸°ëŠ¥ êµ¬í˜„í•˜ê¸° - (1)</a></p>

<p>ìœ„ ê¸€ì—ì„œ ìœ ì € íšŒì›ê°€ì… ê¸°ëŠ¥ êµ¬í˜„ê¹Œì§€ ì™„ë£Œí•´ë³´ì•˜ë‹¤. ê·¸ëŸ°ë° ë¬¸ì œê°€ í•˜ë‚˜ ë‚¨ì•˜ë‹¤. ë°”ë¡œ dbì— ìœ ì €ì˜ ë¹„ë°€ë²ˆí˜¸ê°€ ê·¸ëŒ€ë¡œ ë“¤ì–´ê°„ë‹¤ëŠ” ê²ƒì´ë‹¤.</p>

<p>ìœ ì €ì˜ ë¹„ë°€ë²ˆí˜¸ëŠ” ì ˆëŒ€ ë¹„ë°€ë²ˆí˜¸ ê·¸ëŒ€ë¡œ dbì— ì €ì¥í•˜ì§€ ì•ŠëŠ”ë‹¤. dbê°€ í•´í‚¹ì„ ë‹¹í•˜ë©´ ìœ ì €ì˜ ë¹„ë°€ë²ˆí˜¸ë„ ê·¸ëŒ€ë¡œ ë…¸ì¶œë˜ë©° ì™¸ë¶€ í•´í‚¹ì´ ì•„ë‹ˆë”ë¼ë„ ë‚´ë¶€ ê°œë°œìë‚˜ ì¸ë ¥ì´ ìœ ì €ë“¤ì˜ ë¹„ë°€ë²ˆí˜¸ë¥¼ ë³¼ ìœ„í—˜ì´ ìˆê¸° ë•Œë¬¸ì´ë‹¤.</p>

<p>ì ì´ì œ, drfë¡œ ë¹„ë°€ë²ˆí˜¸ ì•”í˜¸í™”ë¥¼ ì ìš©í•´ë³´ì.</p>

<h2 id="hash-password">hash password</h2>

<h3 id="ë°©ë²•1-ì‹¤íŒ¨">ë°©ë²•1 (ì‹¤íŒ¨)</h3>

<p>ë¹„ë°€ë²ˆí˜¸ ì•”í˜¸ì—ëŠ” ë‹¨ë°©í–¥ í•´ì‹œ í•¨ìˆ˜ê°€ ì¼ë°˜ì ìœ¼ë¡œ ì“°ì¸ë‹¤. drfë¥¼ ì ìš©í•˜ì§€ ì•Šì•˜ì„ ë•Œ ë‚˜ëŠ” bcryptë¥¼ ì´ìš©í•˜ì—¬ ë¹„ë°€ë²ˆí˜¸ ì•”í˜¸í™”ë¥¼ í–ˆë‹¤. drfì—ëŠ” bcryptë¥¼ ì–´ë–»ê²Œ ì ìš©í•˜ëŠ”ì§€ ëª¨ë¥´ê² ì–´ì„œ ì¼ë‹¨ ê²€ìƒ‰ì„ í•´ë´¤ë‹¤. (ë‚˜ì˜ êµ¬ì›ì ìŠ¤íƒì˜¤ë²„í”Œë¡œìš° ğŸ¥º)</p>

<p>https://stackoverflow.com/questions/61065339/how-do-i-hash-passwords-in-drf</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">def</span> <span class="nf">create</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">validated_data</span><span class="p">):</span>
    <span class="n">user</span> <span class="o">=</span> <span class="nb">super</span><span class="p">(</span><span class="n">UserSerializer</span><span class="p">,</span> <span class="bp">self</span><span class="p">).</span><span class="n">create</span><span class="p">(</span><span class="n">validated_data</span><span class="p">)</span>
    <span class="n">user</span><span class="p">.</span><span class="n">set_password</span><span class="p">(</span><span class="n">validated_data</span><span class="p">[</span><span class="s">'password'</span><span class="p">])</span>
    <span class="n">user</span><span class="p">.</span><span class="n">save</span><span class="p">()</span>
    <span class="k">return</span> <span class="n">user</span>
</code></pre></div></div>

<p>ìœ„ ìŠ¤íƒì˜¤ë²„í”Œë¡œìš° ë§í¬ì— ë”°ë¼ ìœ„ ì½”ë“œë¥¼ <code class="language-plaintext highlighter-rouge">models.py</code>ì— ì ìš©í•˜ê³  ì„œë²„ë¥¼ ì‹¤í–‰í•˜ë‹ˆ ë˜ ì—ëŸ¬ê°€ ë°œìƒí–ˆë‹¤.</p>

<p><code class="language-plaintext highlighter-rouge">ImportError: cannot import name 'User' from partially initialized module 'accounts.models' (most likely due to a circular import) (/code/accounts/models.py)</code></p>

<p>ë˜ ë¨¸ë¦¬ë¥¼ ì‹¸ë§¤ê³  ê²€ìƒ‰í•´ë³´ë‹ˆ ì•„ë§ˆ import í•œ íŒŒì¼ë“¤ì˜ <strong>ìˆœí™˜ ì˜ì¡´ì„±</strong> ë•Œë¬¸ì— ìƒê¸´ ì—ëŸ¬ ê°™ì•˜ë‹¤. =&gt; <a href="https://gardeny.tistory.com/11">ë‚˜ë¥¼ êµ¬ì›í•´ì¤€ ë¸”ë¡œê·¸ ë§í¬</a></p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># models.py
</span><span class="kn">from</span> <span class="nn">django.contrib.auth.models</span> <span class="kn">import</span> <span class="n">BaseUserManager</span><span class="p">,</span> <span class="n">AbstractBaseUser</span>
<span class="kn">from</span> <span class="nn">django.db</span> <span class="kn">import</span> <span class="n">models</span>

<span class="kn">from</span> <span class="nn">accounts.serializers</span> <span class="kn">import</span> <span class="n">UserSerializer</span>
</code></pre></div></div>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># serializers.py
</span><span class="kn">from</span> <span class="nn">rest_framework</span> <span class="kn">import</span> <span class="n">serializers</span>
<span class="kn">from</span> <span class="nn">.models</span> <span class="kn">import</span> <span class="n">User</span>
</code></pre></div></div>

<p>ìœ„ëŠ” modelsì— import í•œ ëª¨ë“ˆì´ê³  ë°‘ì€ serializersì— import í•œ ëª¨ë“ˆì´ë‹¤.</p>

<p>ì•„ë§ˆ modelsì—ì„œë„ serializersë¥¼ ì˜ì¡´í•˜ê³  ìˆê³  serializersì—ì„œë„ modelsë¥¼ ì˜ì¡´í•˜ê³  ìˆì–´ ìƒê¸´ ë¬¸ì œ ê°™ì•˜ë‹¤.</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># serializers.py
</span><span class="kn">from</span> <span class="nn">rest_framework</span> <span class="kn">import</span> <span class="n">serializers</span>

<span class="kn">from</span> <span class="nn">.models</span> <span class="kn">import</span> <span class="n">User</span>

<span class="k">class</span> <span class="nc">UserSerializer</span><span class="p">(</span><span class="n">serializers</span><span class="p">.</span><span class="n">HyperlinkedModelSerializer</span><span class="p">):</span>
    <span class="k">class</span> <span class="nc">Meta</span><span class="p">:</span>
        <span class="n">model</span> <span class="o">=</span> <span class="n">User</span>
        <span class="n">fields</span> <span class="o">=</span> <span class="p">[</span><span class="s">"email"</span><span class="p">,</span> <span class="s">"password"</span><span class="p">]</span>

</code></pre></div></div>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># serializers.py
</span><span class="kn">from</span> <span class="nn">rest_framework</span> <span class="kn">import</span> <span class="n">serializers</span>


<span class="k">class</span> <span class="nc">UserSerializer</span><span class="p">(</span><span class="n">serializers</span><span class="p">.</span><span class="n">HyperlinkedModelSerializer</span><span class="p">):</span>
    <span class="k">class</span> <span class="nc">Meta</span><span class="p">:</span>
        <span class="n">model</span> <span class="o">=</span> <span class="s">'accounts.User'</span>
        <span class="n">fields</span> <span class="o">=</span> <span class="p">[</span><span class="s">"email"</span><span class="p">,</span> <span class="s">"password"</span><span class="p">]</span>

</code></pre></div></div>

<p>ìœ„ì²˜ëŸ¼ <code class="language-plaintext highlighter-rouge">models.py</code>ì—ì„œ Userë¥¼ ë¶ˆëŸ¬ì™€ ì˜ì¡´ì ì´ì—ˆë˜ íŒŒì¼ì„ ë°‘ ì½”ë“œì™€ ê°™ì´ â€˜accouts.Userâ€™ ê³¼ ê°™ì´ ë°”ê¿”ì¤€ë‹¤. ì´ì™€ ê°™ì´ ë°”ê¿”ì£¼ë©´ í•´ë‹¹ modelì„ í•„ìš” ì‹œì—ë§Œ import í•´ì˜¤ê¸° ë•Œë¬¸ì— ì˜¤ë¥˜ë¥¼ ë„ìš°ì§€ ì•ŠëŠ”ë‹¤ê³  í•œë‹¤.</p>

<p>ê·¸ëŸ°ë° http://127.0.0.1:8000/users/ ì— ì ‘ì†í•˜ë‹ˆ <code class="language-plaintext highlighter-rouge">'str' object has no attribute '_meta'</code> ë¼ëŠ” ì—ëŸ¬ê°€ ë°œìƒí–ˆë‹¤. (ë©ˆì¶”ì§€ ì•ŠëŠ” ì—ëŸ¬..) ì•„ë§ˆ Meta í´ë˜ìŠ¤ì˜ modelì—ëŠ” ë¬¸ìì—´ì´ ë“¤ì–´ê°€ë©´ ì•ˆë˜ëŠ” ê²ƒ ê°™ë‹¤..ğŸ˜±</p>

<p>ìœ„ ìŠ¤íƒì˜¤ë²„í”Œë¡œìš°ì—ì„œ ì°¾ì€ ì½”ë“œëŠ” serializerì„ ì˜ì¡´í•œ ì½”ë“œê¸° ë•Œë¬¸ì— ë‹¤ë¥¸ ë°©ë²•ì„ ì°¾ì•„ë³´ê¸°ë¡œ í–ˆë‹¤. í•˜í•˜..</p>

<h3 id="ë°©ë²•2-ì„±ê³µ">ë°©ë²•2 (ì„±ê³µ)</h3>

<p>ë˜ êµ¬ê¸€ë§ìœ¼ë¡œ ë’¤ì§€ê³  ë’¤ì§€ë‹¤..</p>

<p>https://stackoverflow.com/questions/41332528/how-to-hash-django-user-password-in-django-rest-framework</p>

<p>ìœ„ ë§í¬ì— ë”°ë¼ì„œ í•œë²ˆ <code class="language-plaintext highlighter-rouge">serializers.py</code>ë¥¼ ìˆ˜ì •í•´ë³´ê¸°ë¡œ í–ˆë‹¤.</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># serializers.py
</span><span class="kn">from</span> <span class="nn">rest_framework</span> <span class="kn">import</span> <span class="n">serializers</span>

<span class="kn">from</span> <span class="nn">django.contrib.auth.hashers</span> <span class="kn">import</span> <span class="n">make_password</span>

<span class="kn">from</span> <span class="nn">.models</span> <span class="kn">import</span> <span class="n">User</span>

<span class="k">class</span> <span class="nc">UserSerializer</span><span class="p">(</span><span class="n">serializers</span><span class="p">.</span><span class="n">HyperlinkedModelSerializer</span><span class="p">):</span>

    <span class="k">def</span> <span class="nf">create</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">validated_data</span><span class="p">):</span>
        <span class="n">validated_data</span><span class="p">[</span><span class="s">'password'</span><span class="p">]</span> <span class="o">=</span> <span class="n">make_password</span><span class="p">(</span><span class="n">validated_data</span><span class="p">[</span><span class="s">'password'</span><span class="p">])</span>
        <span class="k">return</span> <span class="nb">super</span><span class="p">(</span><span class="n">UserSerializer</span><span class="p">,</span> <span class="bp">self</span><span class="p">).</span><span class="n">create</span><span class="p">(</span><span class="n">validated_data</span><span class="p">)</span>

    <span class="k">class</span> <span class="nc">Meta</span><span class="p">:</span>
        <span class="n">model</span> <span class="o">=</span> <span class="n">User</span>
        <span class="n">fields</span> <span class="o">=</span> <span class="p">[</span><span class="s">"email"</span><span class="p">,</span> <span class="s">"password"</span><span class="p">]</span>

</code></pre></div></div>

<p>make_passwordëŠ” passwordë¥¼ hash í•´ì£¼ëŠ” ëª¨ë“ˆì¸ ê²ƒ ê°™ë‹¤. ë“¤ì–´ì˜¨ password dataë¥¼ hashí•´ì¤€ í›„ return í•´ì£¼ëŠ” ì½”ë“œ ì¸ë“¯í•˜ë‹¤. ì–´ì¨Œë“  ì´ ì½”ë“œë¥¼ ì ìš©í•´ì£¼ì—ˆë‹¤.</p>

<p>ğŸ˜­ ì„œ..ì„±ê³µí–ˆë‹¤. ë¹„ë°€ë²ˆí˜¸ê°€ ì•”í˜¸í™”ë˜ì–´ ì €ì¥ë˜ì—ˆë‹¤. ê°¬ë™â€¦.</p>
:ET